<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Fastify cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Fastify cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints/fastify.md" >edit</a>
  </div>
  <div class="toc">
<b>Getting started</b>: <a href="#introduction">Introduction</a>, <a href="#hello-world">Hello world</a>, <a href="#plugins">Plugins</a><br>
<b>Routes</b>: <a href="#writing-routes">Writing routes</a>, <a href="#shorthand-declarations">Shorthand declarations</a>, <a href="#async-await">Async/await</a><br>
<b>Request/reply</b>: <a href="#request">Request</a>, <a href="#reply">Reply</a>, <a href="#json-schema">JSON schema</a><br>
<b>Plugins</b>: <a href="#with-function">With function</a>, <a href="#multiple">Multiple</a>, <a href="#register-with-prefix">Register with prefix</a>, <a href="#helmet">Helmet</a>, <a href="#fastify-plugin">fastify-plugin</a>, <a href="#decorators">Decorators</a><br>
<b>Middleware</b>: <a href="#middleware1">Middleware</a><br>
<b>Template rendering</b>: <a href="#point-of-view">point-of-view</a>, <a href="#options">Options</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h2 id="getting-started">Getting started</h2>
<h3 id="introduction">Introduction</h3>
<p><a href="https://github.com/fastify/fastify">Fastify</a> lets you create HTTP servers in Node.js with good performance. This guide targets fastify v0.28.x.</p>

<ul>
<li><a href="https://github.com/fastify/fastify">Fastify source code</a> <em>(github.com)</em></li>
<li><a href="https://github.com/fastify/fastify#documentation">Documentation</a> <em>(github.com)</em></li>
</ul>
<h3 id="hello-world">Hello world</h3>

<pre><code class="js"><span class="hljs-keyword">const</span> fastify = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fastify&#x27;</span>)()

fastify.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, reply</span>) =&gt;</span> {
  reply.<span class="hljs-title function_">send</span>({ <span class="hljs-attr">hello</span>: <span class="hljs-string">&#x27;world&#x27;</span> })
})

fastify.<span class="hljs-title function_">listen</span>(<span class="hljs-number">3000</span>, <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err
  <span class="hljs-keyword">const</span> port = fastify.<span class="hljs-property">server</span>.<span class="hljs-title function_">address</span>().<span class="hljs-property">port</span>
  <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">`server listening on <span class="hljs-subst">${port}</span>`</span>)
})
</code></pre>
<h3 id="plugins">Plugins</h3>
<h4 id="app-js">app.js</h4>

<pre><code class="js">fastify.<span class="hljs-title function_">register</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./route&#x27;</span>))
</code></pre>
<h4 id="route-js">route.js</h4>

<pre><code class="js"><span class="hljs-keyword">function</span> (<span class="hljs-params">fastify, opts, next</span>) {
  fastify.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, reply</span>) =&gt;</span> {
    reply.<span class="hljs-title function_">send</span>({ <span class="hljs-attr">hello</span>: <span class="hljs-string">&#x27;world&#x27;</span> })
  })

  <span class="hljs-title function_">next</span>()
})
</code></pre>
<p>Compose your app functionality into plugins. Plugins are simply functions.</p>
<p>See: <a href="https://github.com/fastify/fastify/blob/master/docs/Plugins.md">Plugins</a></p>
<h2 id="routes">Routes</h2>
<h3 id="writing-routes">Writing routes</h3>

<pre><code class="js">fastify.<span class="hljs-title function_">route</span>({
  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;GET&#x27;</span>,
  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/&#x27;</span>,
  <span class="hljs-attr">schema</span>: { ··· },
  <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">req, reply</span>) =&gt;</span> { ··· }
  <span class="hljs-attr">beforeHandler</span>: <span class="hljs-function">(<span class="hljs-params">req, reply, done</span>) =&gt;</span> { ··· }
})
</code></pre>
<h3 id="shorthand-declarations">Shorthand declarations</h3>

<pre><code class="js">fastify.<span class="hljs-title function_">get</span>(path, [options], handler)
fastify.<span class="hljs-title function_">head</span>(···)
fastify.<span class="hljs-title function_">post</span>(···)
fastify.<span class="hljs-title function_">put</span>(···)
fastify.<span class="hljs-title function_">delete</span>(···)
fastify.<span class="hljs-title function_">options</span>(···)
fastify.<span class="hljs-title function_">patch</span>(···)
</code></pre>
<h3 id="async-await">Async/await</h3>

<pre><code class="js">fastify.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, options, <span class="hljs-keyword">async</span> (req, reply) =&gt; {
  <span class="hljs-keyword">return</span> data
  <span class="hljs-comment">// or</span>
  reply.<span class="hljs-title function_">send</span>(data)
})
</code></pre>
<p>When using async functions, you can either <code>return</code> data or use <code>reply.send</code>.</p>
<h2 id="request-reply">Request/reply</h2>
<h3 id="request">Request</h3>

<pre><code class="js">request.<span class="hljs-property">query</span>
request.<span class="hljs-property">body</span>
request.<span class="hljs-property">params</span>
request.<span class="hljs-property">headers</span>
request.<span class="hljs-property">req</span>  <span class="hljs-comment">// Node.js core</span>
request.<span class="hljs-property">log</span>.<span class="hljs-title function_">info</span>(<span class="hljs-string">&#x27;hello&#x27;</span>)
</code></pre>
<p>See: <a href="https://github.com/fastify/fastify/blob/master/docs/Request.md">Request</a></p>
<h3 id="reply">Reply</h3>
<h4 id="response-headers">Response headers</h4>

<pre><code class="js">reply.<span class="hljs-title function_">code</span>(<span class="hljs-number">404</span>)
reply.<span class="hljs-title function_">header</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>, <span class="hljs-string">&#x27;text/html&#x27;</span>)
reply.<span class="hljs-title function_">type</span>(<span class="hljs-string">&#x27;text/html&#x27;</span>)
</code></pre>
<h4 id="redirects">Redirects</h4>

<pre><code class="js">reply.<span class="hljs-title function_">redirect</span>(<span class="hljs-string">&#x27;/foo&#x27;</span>)
reply.<span class="hljs-title function_">redirect</span>(<span class="hljs-number">302</span>, <span class="hljs-string">&#x27;/foo&#x27;</span>)
</code></pre>
<h4 id="sending">Sending</h4>

<pre><code class="js">reply.<span class="hljs-title function_">send</span>(payload)
reply.<span class="hljs-property">sent</span> <span class="hljs-comment">// → true|false</span>
</code></pre>
<p>See: <a href="https://github.com/fastify/fastify/blob/master/docs/Reply.md">Reply</a></p>
<h3 id="json-schema">JSON schema</h3>
<h4 id="define-a-json-schema">Define a JSON schema</h4>

<pre><code class="js"><span class="hljs-keyword">const</span> schema = {
  <span class="hljs-attr">querystring</span>: {
    <span class="hljs-attr">name</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span> },
    <span class="hljs-attr">excitement</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;integer&#x27;</span> }
  },
  <span class="hljs-attr">response</span>: {
    <span class="hljs-number">200</span>: {
      <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;object&#x27;</span>,
      <span class="hljs-attr">properties</span>: {
        <span class="hljs-attr">hello</span>: { <span class="hljs-attr">type</span>: <span class="hljs-string">&#x27;string&#x27;</span> }
      }
    }
  }
}
</code></pre>
<h4 id="pass-it-to-the-route">Pass it to the route</h4>

<pre><code class="js">fastify.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, { schema }, <span class="hljs-function">(<span class="hljs-params">req, reply</span>) =&gt;</span> {
  ···
})
</code></pre>
<h4 id="or-same-as-above-">or (same as above)</h4>

<pre><code class="js">fastify.<span class="hljs-title function_">route</span>({
  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;GET&#x27;</span>,
  <span class="hljs-attr">url</span>: <span class="hljs-string">&#x27;/&#x27;</span>,
  schema,
  <span class="hljs-attr">handler</span>: <span class="hljs-function">(<span class="hljs-params">req, reply</span>) =&gt;</span> { ··· }
})
</code></pre>
<p>By defining a JSON schema, you get validation and improved performance.</p>
<p>See: <a href="https://github.com/fastify/fastify/blob/master/docs/Validation-And-Serialization.md">Validation and serialization</a></p>
<h2 id="plugins1">Plugins</h2>
<h3 id="with-function">With function</h3>

<pre><code class="js">fastify.<span class="hljs-title function_">register</span>(
  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./route&#x27;</span>),
  <span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> { <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err }
)
</code></pre>
<h4 id="route-js1">route.js</h4>

<pre><code class="js"><span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-function">(<span class="hljs-params">fastify, options, next</span>) =&gt;</span> {
  fastify.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, ···)
  <span class="hljs-title function_">next</span>()
}
</code></pre>
<p>See: <a href="https://github.com/fastify/fastify/blob/master/docs/Getting-Started.md#register">Register</a></p>
<h3 id="multiple">Multiple</h3>

<pre><code class="js">fastify.<span class="hljs-title function_">register</span>([
  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./another-route&#x27;</span>),
  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./yet-another-route&#x27;</span>)
], opts, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> err
})
</code></pre>
<p>You can pass arrays to <code>register()</code>.</p>
<h3 id="register-with-prefix">Register with prefix</h3>

<pre><code class="js">fastify.<span class="hljs-title function_">register</span>(
  <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;./route&#x27;</span>),
  { <span class="hljs-attr">prefix</span>: <span class="hljs-string">&#x27;/v1&#x27;</span> }
)
</code></pre>
<p>This prefixes all routes in that module.</p>
<h3 id="helmet">Helmet</h3>

<pre><code class="js"><span class="hljs-keyword">const</span> helmet = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fastify-helmet&#x27;</span>)

fastify.<span class="hljs-title function_">register</span>(helmet)
</code></pre>
<p>See: <a href="https://github.com/fastify/fastify-helmet">fastify-helmet</a></p>
<h3 id="fastify-plugin">fastify-plugin</h3>

<pre><code class="js"><span class="hljs-keyword">const</span> fp = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fastify-plugin&#x27;</span>)

<span class="hljs-variable language_">module</span>.<span class="hljs-property">exports</span> = <span class="hljs-title function_">fp</span>(<span class="hljs-function">(<span class="hljs-params">fastify, opts, next</span>) =&gt;</span> {
  <span class="hljs-comment">// your plugin code</span>
  fastify.<span class="hljs-title function_">decorate</span>(<span class="hljs-string">&#x27;utility&#x27;</span>, <span class="hljs-function">() =&gt;</span> {})

  <span class="hljs-title function_">next</span>()
}, <span class="hljs-string">&#x27;0.x&#x27;</span>)
</code></pre>
<p>Allows you to limit Fastify versions via semver, and allows you not make a new Fastify scope.</p>
<p>See: <a href="https://github.com/fastify/fastify-plugin">fastify-plugin</a></p>
<h3 id="decorators">Decorators</h3>
<h2 id="middleware">Middleware</h2>
<h3 id="middleware1">Middleware</h3>

<pre><code class="js">fastify.<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;cors&#x27;</span>)())
fastify.<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;dns-prefetch-control&#x27;</span>)())
fastify.<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;frameguard&#x27;</span>)())
fastify.<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;hide-powered-by&#x27;</span>)())
fastify.<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;hsts&#x27;</span>)())
fastify.<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;ienoopen&#x27;</span>)())
fastify.<span class="hljs-title function_">use</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;x-xss-protection&#x27;</span>)())
</code></pre>
<p>Compatible with Express and Restify middlewares. (Don&#39;t use these middleware, these are covered by <a href="https://github.com/fastify/fastify-helmet">fastify-helmet</a>.)</p>
<p>See: <a href="https://github.com/fastify/fastify/blob/master/docs/Middlewares.md">Middlewares</a></p>
<h2 id="template-rendering">Template rendering</h2>
<h3 id="point-of-view">point-of-view</h3>

<pre><code class="js"><span class="hljs-keyword">const</span> fastify = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fastify&#x27;</span>)()

fastify.<span class="hljs-title function_">register</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;point-of-view&#x27;</span>), {
  <span class="hljs-attr">engine</span>: {
    <span class="hljs-attr">ejs</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;ejs&#x27;</span>)
  }
})
</code></pre>

<pre><code class="js">fastify.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;/&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">req, reply</span>) =&gt;</span> {
  reply.<span class="hljs-title function_">view</span>(<span class="hljs-string">&#x27;/templates/index.ejs&#x27;</span>, { <span class="hljs-attr">text</span>: <span class="hljs-string">&#x27;text&#x27;</span> })
})
</code></pre>
<p>Support <code>ejs</code>, <code>pug</code>, <code>handlebars</code> and <code>marko</code>.</p>
<p>See: <a href="https://github.com/fastify/point-of-view">point-of-view</a></p>
<h3 id="options">Options</h3>

<pre><code class="js">fastify.<span class="hljs-title function_">register</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;point-of-view&#x27;</span>), {
  <span class="hljs-attr">engine</span>: {
    <span class="hljs-attr">ejs</span>: <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;ejs&#x27;</span>)
  },
  <span class="hljs-attr">templates</span>: <span class="hljs-string">&#x27;/templates&#x27;</span>,
  <span class="hljs-attr">options</span>: {}
})
</code></pre>
<p><code>templates</code> lets you update the templates folder. <code>options</code> are options passed onto the template engines.</p>

</div>
</body>  
</html>