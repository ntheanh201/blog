<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Do gem cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Do gem cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints/do.md" >edit</a>
  </div>
  <div class="toc">
<b>Main</b>: <a href="#connection">Connection</a>, <a href="#run">Run</a>, <a href="#files">Files</a>, <a href="#upload-download">Upload/download</a>, <a href="#replace">Replace</a>, <a href="#replace-via-regex">Replace via regex</a>, <a href="#append">Append</a>, <a href="#append-to-top">Append to top</a>, <a href="#prompt">Prompt</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">

<ul>
<li><a href="https://github.com/DAddYE/do">DAddYE/do</a></li>
</ul>
<h3 id="connection">Connection</h3>

<pre><code>server = DO::Server.<span class="hljs-keyword">new</span>(<span class="hljs-string">&#x27;srv1&#x27;</span>, <span class="hljs-string">&#x27;srv1.domain.local&#x27;</span>, <span class="hljs-string">&#x27;root&#x27;</span>, :<span class="hljs-function"><span class="hljs-params">key</span> =&gt;</span> 
    %w[srv1.pem]
</code></pre>
<h3 id="run">Run</h3>

<pre><code>server.<span class="hljs-built_in">run</span> <span class="hljs-string">&#x27;uname&#x27;</span>
<span class="hljs-meta"># root@srv1 ~ # uname</span>
<span class="hljs-meta"># Linux</span>

server.<span class="hljs-built_in">run</span> <span class="hljs-string">&#x27;uname&#x27;</span>, <span class="hljs-string">&#x27;-a&#x27;</span>
<span class="hljs-meta"># root@srv1 ~ # uname -a</span>
<span class="hljs-meta"># Linux srv1.lipsiasoft.net 2.6.18-194.32.1.el5  x86_64 x86_64 x86_64 GNU/Linux</span>

server.<span class="hljs-built_in">run</span> <span class="hljs-string">&#x27;mysqladmin -u root -p password &quot;oldone&quot;&#x27;</span>, <span class="hljs-string">&#x27;newpassword&#x27;</span>
<span class="hljs-meta"># root@srv1 ~ # mysqladmin -u root -p password <span class="hljs-string">&#x27;oldone&#x27;</span></span>
<span class="hljs-meta"># Enter password: oldone</span>
<span class="hljs-meta"># mysqladmin: connect to server at <span class="hljs-string">&#x27;localhost&#x27;</span> failed</span>
<span class="hljs-meta"># error: <span class="hljs-string">&#x27;Access denied for user &#x27;</span>root<span class="hljs-string">&#x27;@&#x27;</span>localhost<span class="hljs-string">&#x27; (using password: YES)&#x27;</span></span>
</code></pre>
<h3 id="files">Files</h3>

<pre><code>server.exist?(<span class="hljs-string">&#x27;~/.ssh&#x27;</span>)
# root@srv1 ~ # test -e ~/.ssh &amp;&amp; echo <span class="hljs-literal">True</span>
# =&gt; true

server.read(<span class="hljs-string">&#x27;/etc/redhat-release&#x27;</span>)
# root@srv1 ~ # cat /etc/redhat-release
# =&gt; <span class="hljs-string">&quot;CentOS release 5.5 (Final)&quot;</span>
</code></pre>
<h3 id="upload-download">Upload/download</h3>

<pre><code>server.upload <span class="hljs-string">&#x27;/tmp/file&#x27;</span>, <span class="hljs-string">&#x27;/tmp/foo&#x27;</span>
# root@srv1 ~ # upload <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;/tmp/file&#x27;</span> to <span class="hljs-string">&#x27;/tmp/foo&#x27;</span>

server.download <span class="hljs-string">&#x27;/tmp/foo&#x27;</span>, <span class="hljs-string">&#x27;/tmp/file2&#x27;</span>
# root@srv1 ~ # download <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;/tmp/foo&#x27;</span> to <span class="hljs-string">&#x27;/tmp/file2&#x27;</span>
</code></pre>
<h3 id="replace">Replace</h3>

<pre><code>server.replace :all, <span class="hljs-string">&#x27;new content&#x27;</span>, <span class="hljs-string">&#x27;/tmp/file&#x27;</span>
# root@srv1 ~ # replace all <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;/tmp/foo&#x27;</span>

server.read(<span class="hljs-string">&#x27;/tmp/foo&#x27;</span>)
# root@srv1 ~ # cat /tmp/foo
# =&gt; <span class="hljs-string">&quot;new content&quot;</span>
</code></pre>
<h3 id="replace-via-regex">Replace via regex</h3>

<pre><code>server.replace <span class="hljs-regexp">/content$/</span>, <span class="hljs-string">&#x27;changed content&#x27;</span>, <span class="hljs-string">&#x27;/tmp/foo&#x27;</span>
# root@srv1 ~ # replace <span class="hljs-regexp">/content$/</span> in <span class="hljs-string">&#x27;/tmp/foo&#x27;</span>

server.<span class="hljs-keyword">read</span>(<span class="hljs-string">&#x27;/tmp/foo&#x27;</span>)
# root@srv1 ~ # cat <span class="hljs-regexp">/tmp/</span>foo
# =&gt; <span class="hljs-string">&quot;new changed content&quot;</span>
</code></pre>
<h3 id="append">Append</h3>

<pre><code>server.append(<span class="hljs-string">&#x27;appended&#x27;</span>, <span class="hljs-string">&#x27;/tmp/foo&#x27;</span>)
# root@srv1 ~ # append to <span class="hljs-string">&#x27;bottom&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;/tmp/foo&#x27;</span>

server.read(<span class="hljs-string">&#x27;/tmp/foo&#x27;</span>)
# root@srv1 ~ # cat /tmp/foo
# =&gt; <span class="hljs-string">&quot;new changed contentappended&quot;</span>
</code></pre>
<h3 id="append-to-top">Append to top</h3>

<pre><code>server.append(<span class="hljs-string">&#x27;---&#x27;</span>, <span class="hljs-string">&#x27;/tmp/foo&#x27;</span>, :top)
# root@srv1 ~ # append to <span class="hljs-string">&#x27;top&#x27;</span> <span class="hljs-keyword">in</span> <span class="hljs-string">&#x27;/tmp/foo&#x27;</span>

server.read(<span class="hljs-string">&#x27;/tmp/foo&#x27;</span>)
# root@srv1 ~ # cat /tmp/foo
# =&gt; <span class="hljs-string">&quot;---new changed contentappended&quot;</span>
</code></pre>
<h3 id="prompt">Prompt</h3>

<pre><code><span class="hljs-keyword">server</span>.ask <span class="hljs-string">&quot;Please choose&quot;</span>
<span class="hljs-meta"># root@srv1 ~ # Please choose: foo</span>
<span class="hljs-meta"># =&gt; &quot;foo&quot;</span>

<span class="hljs-keyword">server</span>.yes? <span class="hljs-string">&quot;Do you want to proceed&quot;</span>
<span class="hljs-meta"># root@srv1 ~ # Do you want to proceed? (y/n): y</span>
<span class="hljs-meta"># =&gt; 0</span>

<span class="hljs-keyword">server</span>.wait
<span class="hljs-meta"># Press ENTER to continue...</span>
</code></pre>

</div>
</body>  
</html>