<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Phoenix: Plug.Conn cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Phoenix: Plug.Conn cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints\phoenix-conn.md" >edit</a>
  </div>
  <div class="toc">
<b>Request</b>: <a href="#request">Request</a>, <a href="#updating-conn">Updating conn</a><br>
<b>Response</b>: <a href="#response">Response</a>, <a href="#sending-responses">Sending responses</a>, <a href="#phoenix-views">Phoenix views</a><br>
<b>Other features</b>: <a href="#other-fields">Other fields</a>, <a href="#accepts">Accepts</a>, <a href="#assigns">Assigns</a>, <a href="#session">Session</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h2 id="request">Request</h2>
<h3 id="request">Request</h3>

<pre><code class="elixir">conn.host          <span class="hljs-comment"># → &quot;example.com&quot;</span>
conn.method        <span class="hljs-comment"># → &quot;GET&quot;</span>
conn.path_info     <span class="hljs-comment"># → [&quot;posts&quot;, &quot;1&quot;]</span>
conn.request_path  <span class="hljs-comment"># → &quot;/posts/1&quot;</span>
conn.query_string  <span class="hljs-comment"># → &quot;utm_source=twitter&quot;</span>
conn.port          <span class="hljs-comment"># → 80</span>
conn.scheme        <span class="hljs-comment"># → :http</span>
conn.peer          <span class="hljs-comment"># → { {127, 0, 0, 1}, 12345 }</span>
conn.remote_ip     <span class="hljs-comment"># → { 151, 236, 219, 228 }</span>
conn.req_headers   <span class="hljs-comment"># → [{&quot;content-type&quot;, &quot;text/plain&quot;}]</span>
</code></pre>

<pre><code class="elixir">conn |&gt; get_req_header(<span class="hljs-string">&quot;content-type&quot;</span>)
<span class="hljs-comment"># → [&quot;text/plain&quot;]</span>
</code></pre>
<h3 id="updating-conn">Updating conn</h3>

<pre><code class="elixir">conn
|&gt; put_req_header(<span class="hljs-string">&quot;accept&quot;</span>, <span class="hljs-string">&quot;application/json&quot;</span>)
</code></pre>
<p>Usually only useful for tests.</p>
<h2 id="response">Response</h2>
<h3 id="response">Response</h3>

<pre><code class="elixir">conn.resp_body     <span class="hljs-comment"># → &quot;...&quot;</span>
conn.resp_charset  <span class="hljs-comment"># → &quot;utf-8&quot;</span>
conn.resp_cookies  <span class="hljs-comment"># → ...</span>
conn.resp_headers  <span class="hljs-comment"># → ...</span>
conn.status        <span class="hljs-comment"># → ...</span>
</code></pre>
<h3 id="sending-responses">Sending responses</h3>

<pre><code class="elixir"><span class="hljs-comment"># Plug.Conn</span>
conn
|&gt; html(<span class="hljs-string">&quot;&lt;html&gt;&lt;head&gt;...&quot;</span>)
|&gt; json(%{ <span class="hljs-symbol">message:</span> <span class="hljs-string">&quot;Hello&quot;</span> })
|&gt; text(<span class="hljs-string">&quot;Hello&quot;</span>)
</code></pre>

<pre><code class="elixir">|&gt; redirect(<span class="hljs-symbol">to:</span> <span class="hljs-string">&quot;/foo&quot;</span>)
|&gt; redirect(<span class="hljs-symbol">external:</span> <span class="hljs-string">&quot;http://www.google.com/&quot;</span>)
|&gt; halt()
</code></pre>

<pre><code class="elixir">|&gt; put_resp_content_type(<span class="hljs-string">&quot;text/plain&quot;</span>)
|&gt; put_resp_cookie(<span class="hljs-string">&quot;abc&quot;</span>, <span class="hljs-string">&quot;def&quot;</span>)
|&gt; put_resp_header(<span class="hljs-string">&quot;X-Delivered-By&quot;</span>, <span class="hljs-string">&quot;myapp&quot;</span>)
|&gt; put_status(<span class="hljs-number">202</span>)
|&gt; put_status(<span class="hljs-symbol">:not_found</span>)
</code></pre>

<pre><code class="elixir">|&gt; put_private(<span class="hljs-symbol">:plug_foo</span>, <span class="hljs-string">&quot;...&quot;</span>)  <span class="hljs-comment"># reserved for libraries</span>
</code></pre>

<pre><code class="elixir">|&gt; send_resp(<span class="hljs-number">201</span>, <span class="hljs-string">&quot;&quot;</span>)
</code></pre>
<h3 id="phoenix-views">Phoenix views</h3>

<pre><code class="elixir"><span class="hljs-comment"># Phoenix.Controller</span>
conn
|&gt; render(<span class="hljs-string">&quot;index.html&quot;</span>)
|&gt; render(<span class="hljs-string">&quot;index.html&quot;</span>, <span class="hljs-symbol">hello:</span> <span class="hljs-string">&quot;world&quot;</span>)
|&gt; render(MyApp.ErrorView, <span class="hljs-string">&quot;404.html&quot;</span>)
</code></pre>

<pre><code class="elixir">|&gt; put_layout(<span class="hljs-symbol">:foo</span>)
|&gt; put_layout(<span class="hljs-keyword">false</span>)
|&gt; put_view(ErrorView)
</code></pre>

<pre><code class="elixir">|&gt; put_secure_browser_headers()
<span class="hljs-comment"># prevent clickjacking, nosniff, and xss protection</span>
<span class="hljs-comment"># x-frame-options, x-content-type-options, x-xss-protection</span>
</code></pre>

<pre><code class="elixir">|&gt; put_new_view(ErrorView)  <span class="hljs-comment"># if not set yet</span>
|&gt; put_new_layout(<span class="hljs-symbol">:foo</span>)
</code></pre>

<pre><code class="elixir">layout(conn)
</code></pre>
<h2 id="other-features">Other features</h2>
<h3 id="other-fields">Other fields</h3>

<pre><code class="elixir">conn.assigns          <span class="hljs-comment"># storage of crap</span>
conn.owner            <span class="hljs-comment"># process</span>
conn.halted           <span class="hljs-comment"># if pipeline was halted</span>
conn.secret_key_base  <span class="hljs-comment"># ...</span>
conn.state            <span class="hljs-comment"># :unset, :set, :file, :sent, :chunked</span>
</code></pre>
<h3 id="accepts">Accepts</h3>

<pre><code class="js">plug :accepts, [<span class="hljs-string">&quot;html&quot;</span>, <span class="hljs-string">&quot;json&quot;</span>]
conn |&gt; <span class="hljs-title function_">accepts</span>([<span class="hljs-string">&quot;html&quot;</span>, <span class="hljs-string">&quot;json&quot;</span>])
<span class="hljs-title function_">get_format</span>(conn)  # → <span class="hljs-string">&quot;html&quot;</span>
conn.<span class="hljs-property">accepts</span>
</code></pre>
<h3 id="assigns">Assigns</h3>

<pre><code class="elixir">conn.assigns[<span class="hljs-symbol">:hello</span>]
conn |&gt; assign(<span class="hljs-symbol">:user_id</span>, <span class="hljs-number">100</span>)
</code></pre>

<pre><code class="elixir">conn = async_assign(conn, <span class="hljs-symbol">:location</span>, <span class="hljs-keyword">fn</span> -&gt; geoip_lookup() <span class="hljs-keyword">end</span>)
await_assign(conn, <span class="hljs-symbol">:location</span>)
</code></pre>
<h3 id="session">Session</h3>

<pre><code class="elixir">conn = fetch_session(conn)   <span class="hljs-comment"># or plug :fetch_session</span>

conn = put_session(conn, <span class="hljs-symbol">:message</span>, <span class="hljs-string">&quot;new stuff we just set in the session&quot;</span>)
get_session(conn, <span class="hljs-symbol">:message</span>)
conn = clear_session(conn)
</code></pre>

<pre><code class="elixir">conn
|&gt; put_flash(<span class="hljs-symbol">:info</span>, <span class="hljs-string">&quot;Success&quot;</span>)
|&gt; put_flash(<span class="hljs-symbol">:error</span>, <span class="hljs-string">&quot;Oh no&quot;</span>)
</code></pre>
<p>Also available: <code>flash</code> <code>cookie</code> <code>params</code></p>

</div>
</body>  
</html>