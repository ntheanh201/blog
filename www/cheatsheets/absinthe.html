<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Absinthe cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Absinthe cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints\absinthe.md" >edit</a>
  </div>
  <div class="toc">
<b>Introduction</b>: <a href="#concepts">Concepts</a>, <a href="#plug">Plug</a><br>
<b>Main concepts</b>: <a href="#schema">Schema</a>, <a href="#resolver">Resolver</a>, <a href="#type">Type</a><br>
<b>Schema</b>: <a href="#query-arguments">Query arguments</a>, <a href="#mutations">Mutations</a><br>
<a href="#references">References</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h2 id="introduction">Introduction</h2>
<h3 id="concepts">Concepts</h3>

<ul>
<li><code>Schema</code> - The root. Defines what queries you can do, and what types they return.</li>
<li><code>Resolver</code> - Functions that return data.</li>
<li><code>Type</code> - A type definition describing the shape of the data you&#39;ll return.</li>
</ul>
<h3 id="plug">Plug</h3>
<h4 id="web-router-ex">web/router.ex</h4>

<pre><code class="elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">Blog.Web.Router</span></span> <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">use</span> Phoenix.Router

  forward <span class="hljs-string">&quot;/&quot;</span>, Absinthe.Plug,
    <span class="hljs-symbol">schema:</span> Blog.Schema
<span class="hljs-keyword">end</span>
</code></pre>
<p>Absinthe is a Plug, and you pass it one <strong>Schema</strong>.</p>
<p>See: <a href="http://absinthe-graphql.org/tutorial/our-first-query/">Our first query</a></p>
<h2 id="main-concepts">Main concepts</h2>
<h3 id="schema">Schema</h3>
<h4 id="web-schema-ex">web/schema.ex</h4>

<pre><code class="elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">Blog.Schema</span></span> <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">use</span> Absinthe.Schema
  import_types Blog.Schema.Types

  query <span class="hljs-keyword">do</span>
    <span class="hljs-variable">@desc</span> <span class="hljs-string">&quot;Get a list of blog posts&quot;</span>
    field <span class="hljs-symbol">:posts</span>, list_of(<span class="hljs-symbol">:post</span>) <span class="hljs-keyword">do</span>
      resolve &amp;Blog.PostResolver.all/<span class="hljs-number">2</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This schema will account for <code>{ posts { ··· } }</code>. It returns a <strong>Type</strong> of <code>:post</code>, and delegates to a <strong>Resolver</strong>.</p>
<h3 id="resolver">Resolver</h3>
<h4 id="web-resolvers-post_resolver-ex">web/resolvers/post_resolver.ex</h4>

<pre><code class="elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">Blog.PostResolver</span></span> <span class="hljs-keyword">do</span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">all</span></span>(_args, _info) <span class="hljs-keyword">do</span>

  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This is the function that the schema delegated the <code>posts</code> query to.</p>
<h3 id="type">Type</h3>
<h4 id="web-schema-types-ex">web/schema/types.ex</h4>

<pre><code class="elixir"><span class="hljs-class"><span class="hljs-keyword">defmodule</span> <span class="hljs-title">Blog.Schema.Types</span></span> <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">use</span> Absinthe.Schema.Notation

  <span class="hljs-variable">@desc</span> <span class="hljs-string">&quot;A blog post&quot;</span>
  object <span class="hljs-symbol">:post</span> <span class="hljs-keyword">do</span>
    field <span class="hljs-symbol">:id</span>, <span class="hljs-symbol">:id</span>
    field <span class="hljs-symbol">:title</span>, <span class="hljs-symbol">:string</span>
    field <span class="hljs-symbol">:body</span>, <span class="hljs-symbol">:string</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>This defines a type <code>:post</code>, which is used by the resolver.</p>
<h2 id="schema1">Schema</h2>
<h3 id="query-arguments">Query arguments</h3>
<h4 id="graphql-query">GraphQL query</h4>

<pre><code>{ <span class="hljs-title function_">user</span>(<span class="hljs-params">id: <span class="hljs-string">&quot;1&quot;</span></span>) { ··· } }
</code></pre>
<h4 id="web-schema-ex1">web/schema.ex</h4>

<pre><code class="elixir">query <span class="hljs-keyword">do</span>
  field <span class="hljs-symbol">:user</span>, <span class="hljs-symbol">type:</span> <span class="hljs-symbol">:user</span> <span class="hljs-keyword">do</span>
    arg <span class="hljs-symbol">:id</span>, non_null(<span class="hljs-symbol">:id</span>)
    resolve &amp;Blog.UserResolver.find/<span class="hljs-number">2</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h4 id="resolver1">Resolver</h4>

<pre><code class="elixir"><span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">find</span></span>(%{<span class="hljs-symbol">id:</span> id} = args, _info) <span class="hljs-keyword">do</span>
  ···
<span class="hljs-keyword">end</span>
</code></pre>
<p>See: <a href="http://absinthe-graphql.org/tutorial/query-arguments/">Query arguments</a></p>
<h3 id="mutations">Mutations</h3>
<h4 id="graphql-query1">GraphQL query</h4>

<pre><code>{
  mutation <span class="hljs-title class_">CreatePost</span> {
    <span class="hljs-title function_">post</span>(<span class="hljs-params">title: <span class="hljs-string">&quot;Hello&quot;</span></span>) { id }
  }
}
</code></pre>
<h4 id="web-schema-ex11">web/schema.ex</h4>

<pre><code class="elixir">mutation <span class="hljs-keyword">do</span>
  <span class="hljs-variable">@desc</span> <span class="hljs-string">&quot;Create a post&quot;</span>
  field <span class="hljs-symbol">:post</span>, <span class="hljs-symbol">type:</span> <span class="hljs-symbol">:post</span> <span class="hljs-keyword">do</span>
    arg <span class="hljs-symbol">:title</span>, non_null(<span class="hljs-symbol">:string</span>)
    resolve &amp;Blog.PostResolver.create/<span class="hljs-number">2</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>See: <a href="http://absinthe-graphql.org/tutorial/mutations/">Mutations</a></p>
<h2 id="references">References</h2>

<ul>
<li><a href="http://absinthe-graphql.org/">Absinthe website</a> <em>(absinthe-graphql.org)</em></li>
<li><a href="./graphql">GraphQL cheatsheet</a> <em>(devhints.io)</em></li>
</ul>

</div>
</body>  
</html>