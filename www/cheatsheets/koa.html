<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Koa cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Koa cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints/koa.md" >edit</a>
  </div>
  <div class="toc">
<b>Main</b>: <a href="#reference">Reference</a>, <a href="#request">Request</a>, <a href="#response">Response</a>, <a href="#middlewares">Middlewares</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h3 id="reference">Reference</h3>

<pre><code class="js">app.<span class="hljs-title function_">use</span>(<span class="hljs-keyword">function</span> * (next) {
  <span class="hljs-keyword">var</span> ctx = <span class="hljs-variable language_">this</span>

  ctx.<span class="hljs-property">request</span>
  ctx.<span class="hljs-property">response</span>

  ctx.<span class="hljs-property">body</span> = <span class="hljs-string">&#x27;hello&#x27;</span>

  ctx.<span class="hljs-property">state</span>.<span class="hljs-property">user</span> = <span class="hljs-keyword">yield</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">find</span>(id).<span class="hljs-title function_">fetch</span>()

  ctx.<span class="hljs-property">cookies</span>.<span class="hljs-title function_">set</span>(<span class="hljs-string">&#x27;foo&#x27;</span>, <span class="hljs-string">&#x27;hello&#x27;</span>, { <span class="hljs-attr">signed</span>: <span class="hljs-literal">true</span> })
  ctx.<span class="hljs-property">cookies</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;foo&#x27;</span>)

  ctx.<span class="hljs-keyword">throw</span>(<span class="hljs-number">403</span>)
</code></pre>
<h3 id="request">Request</h3>

<pre><code class="js">  ctx.<span class="hljs-property">header</span>        <span class="hljs-comment">// ctx.headers</span>
  ctx.<span class="hljs-property">method</span>        <span class="hljs-comment">// and =</span>
  ctx.<span class="hljs-property">url</span>           <span class="hljs-comment">// and =</span>
  ctx.<span class="hljs-property">originalUrl</span>
  ctx.<span class="hljs-property">origin</span>        <span class="hljs-comment">// =&gt; &#x27;http://example.com&#x27;</span>
  ctx.<span class="hljs-property">href</span>          <span class="hljs-comment">// =&gt; &#x27;http://example.com/foo?q=hello&#x27;</span>
  ctx.<span class="hljs-property">path</span>          <span class="hljs-comment">// and =</span>
  ctx.<span class="hljs-property">query</span>         <span class="hljs-comment">// { q: &#x27;hello&#x27; }</span>
  ctx.<span class="hljs-property">query</span>         <span class="hljs-comment">// and =</span>
  ctx.<span class="hljs-property">querystring</span>
  ctx.<span class="hljs-property">querystring</span>   <span class="hljs-comment">// and =</span>
  ctx.<span class="hljs-property">host</span>
  ctx.<span class="hljs-property">hostname</span>
  ctx.<span class="hljs-property">fresh</span>
  ctx.<span class="hljs-property">stale</span>
  ctx.<span class="hljs-property">socket</span>
  ctx.<span class="hljs-property">protocol</span>
  ctx.<span class="hljs-property">secure</span>
  ctx.<span class="hljs-property">ip</span>
  ctx.<span class="hljs-property">ips</span>
  ctx.<span class="hljs-property">subdomains</span>
  ctx.<span class="hljs-title function_">is</span>()                  <span class="hljs-comment">// .is(&#x27;html&#x27;) .is(&#x27;text/html&#x27;)</span>
  ctx.<span class="hljs-title function_">accepts</span>()             <span class="hljs-comment">// .accepts(&#x27;html&#x27;) .accepts(&#x27;html&#x27;, &#x27;json&#x27;)</span>
  ctx.<span class="hljs-title function_">acceptsEncodings</span>()    <span class="hljs-comment">// .acceptsEncodings(&#x27;gzip&#x27;)</span>
  ctx.<span class="hljs-title function_">acceptsCharsets</span>()
  ctx.<span class="hljs-title function_">acceptsLanguages</span>()
  ctx.<span class="hljs-title function_">get</span>()

  ctx.<span class="hljs-property">request</span>.<span class="hljs-property">type</span>          <span class="hljs-comment">// =&gt; &#x27;image/jpg&#x27;</span>
  ctx.<span class="hljs-property">request</span>.<span class="hljs-property">charset</span>       <span class="hljs-comment">// =&gt; &#x27;utf-8&#x27;</span>
  ctx.<span class="hljs-property">request</span>.<span class="hljs-property">protocol</span>      <span class="hljs-comment">// =&gt; &#x27;https&#x27;</span>
  ctx.<span class="hljs-property">request</span>.<span class="hljs-property">secure</span>        <span class="hljs-comment">// =&gt; true</span>
  ctx.<span class="hljs-property">request</span>.<span class="hljs-property">ip</span>            <span class="hljs-comment">// (supports X-Forwarded-For if app.proxy)</span>
  ctx.<span class="hljs-property">request</span>.<span class="hljs-property">ips</span>
  ctx.<span class="hljs-property">request</span>.<span class="hljs-property">subdomains</span>

  ctx.<span class="hljs-property">request</span>.<span class="hljs-property">fresh</span>
  ctx.<span class="hljs-property">request</span>.<span class="hljs-property">stale</span>
</code></pre>
<h3 id="response">Response</h3>

<pre><code class="js">  ctx.<span class="hljs-property">body</span> = <span class="hljs-string">&#x27;hello&#x27;</span>

  ctx.<span class="hljs-keyword">throw</span>(<span class="hljs-number">403</span>)
  ctx.<span class="hljs-keyword">throw</span>(<span class="hljs-string">&#x27;name required&#x27;</span>, <span class="hljs-number">403</span>)
  ctx.<span class="hljs-keyword">throw</span>(<span class="hljs-number">403</span>, <span class="hljs-string">&#x27;name required&#x27;</span>)
  ctx.<span class="hljs-keyword">throw</span>(<span class="hljs-string">&#x27;oops&#x27;</span>)
  ctx.<span class="hljs-title function_">assert</span>(ctx.<span class="hljs-property">state</span>.<span class="hljs-property">user</span>, <span class="hljs-number">401</span>, <span class="hljs-string">&#x27;You must log in&#x27;</span>)
</code></pre>
<h3 id="middlewares">Middlewares</h3>

<pre><code class="js"><span class="hljs-built_in">exports</span>.<span class="hljs-property">conditionalGet</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-conditional-get&#x27;</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">responseTime</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-response-time&#x27;</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">ratelimit</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-ratelimit&#x27;</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">compress</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-compress&#x27;</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">rewrite</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-rewrite&#x27;</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">favicon</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-favicon&#x27;</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">session</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-session&#x27;</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">static</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-static&#x27;</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">logger</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-logger&#x27;</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">mount</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-mount&#x27;</span>);
<span class="hljs-built_in">exports</span>.<span class="hljs-property">etag</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;koa-etag&#x27;</span>);
</code></pre>

</div>
</body>  
</html>