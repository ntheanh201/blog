<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>fetch() cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / fetch() cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints/js-fetch.md" >edit</a>
  </div>
  <div class="toc">
<b>Main</b>: <a href="#fetch">Fetch</a>, <a href="#response">Response</a>, <a href="#request-options">Request options</a>, <a href="#catching-errors">Catching errors</a>, <a href="#using-with-node-js">Using with node.js</a><br>
<a href="#references">References</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h3 id="fetch">Fetch</h3>

<pre><code class="js"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/data.json&#x27;</span>)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">response</span> =&gt;</span> response.<span class="hljs-title function_">json</span>())
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">data</span> =&gt;</span> {
    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(data)
  })
  .<span class="hljs-title function_">catch</span>(<span class="hljs-function"><span class="hljs-params">err</span> =&gt;</span> ...)
</code></pre>
<h3 id="response">Response</h3>

<pre><code class="js"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/data.json&#x27;</span>)
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
  res.<span class="hljs-title function_">text</span>()       <span class="hljs-comment">// response body (=&gt; Promise)</span>
  res.<span class="hljs-title function_">json</span>()       <span class="hljs-comment">// parse via JSON (=&gt; Promise)</span>
  res.<span class="hljs-property">status</span>       <span class="hljs-comment">//=&gt; 200</span>
  res.<span class="hljs-property">statusText</span>   <span class="hljs-comment">//=&gt; &#x27;OK&#x27;</span>
  res.<span class="hljs-property">redirected</span>   <span class="hljs-comment">//=&gt; false</span>
  res.<span class="hljs-property">ok</span>           <span class="hljs-comment">//=&gt; true</span>
  res.<span class="hljs-property">url</span>          <span class="hljs-comment">//=&gt; &#x27;http://site.com/data.json&#x27;</span>
  res.<span class="hljs-property">type</span>         <span class="hljs-comment">//=&gt; &#x27;basic&#x27;</span>
                   <span class="hljs-comment">//   (&#x27;cors&#x27; &#x27;default&#x27; &#x27;error&#x27;</span>
                   <span class="hljs-comment">//    &#x27;opaque&#x27; &#x27;opaqueredirect&#x27;)</span>

  res.<span class="hljs-property">headers</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;Content-Type&#x27;</span>)
})
</code></pre>
<h3 id="request-options">Request options</h3>

<pre><code class="js"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/data.json&#x27;</span>, {
  <span class="hljs-attr">method</span>: <span class="hljs-string">&#x27;post&#x27;</span>,
  <span class="hljs-attr">body</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>(form), <span class="hljs-comment">// post body</span>
  <span class="hljs-attr">body</span>: <span class="hljs-variable constant_">JSON</span>.<span class="hljs-title function_">stringify</span>(...),

  <span class="hljs-attr">headers</span>: {
    <span class="hljs-string">&#x27;Accept&#x27;</span>: <span class="hljs-string">&#x27;application/json&#x27;</span>
  },

  <span class="hljs-attr">credentials</span>: <span class="hljs-string">&#x27;same-origin&#x27;</span>, <span class="hljs-comment">// send cookies</span>
  <span class="hljs-attr">credentials</span>: <span class="hljs-string">&#x27;include&#x27;</span>,     <span class="hljs-comment">// send cookies, even in CORS</span>

})
</code></pre>
<h3 id="catching-errors">Catching errors</h3>

<pre><code class="js"><span class="hljs-title function_">fetch</span>(<span class="hljs-string">&#x27;/data.json&#x27;</span>)
  .<span class="hljs-title function_">then</span>(checkStatus)
</code></pre>

<pre><code class="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">checkStatus</span> (res) {
  <span class="hljs-keyword">if</span> (res.<span class="hljs-property">status</span> &gt;= <span class="hljs-number">200</span> &amp;&amp; res.<span class="hljs-property">status</span> &lt; <span class="hljs-number">300</span>) {
    <span class="hljs-keyword">return</span> res
  } <span class="hljs-keyword">else</span> {
    <span class="hljs-keyword">let</span> err = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(res.<span class="hljs-property">statusText</span>)
    err.<span class="hljs-property">response</span> = res
    <span class="hljs-keyword">throw</span> err
  }
}
</code></pre>
<p>Non-2xx responses are still successful requests. Use another function to turn them to errors.</p>
<h3 id="using-with-node-js">Using with node.js</h3>

<pre><code class="js"><span class="hljs-keyword">const</span> fetch = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;isomorphic-fetch&#x27;</span>)
</code></pre>
<p>See: <a href="https://npmjs.com/package/isomorphic-fetch">isomorphic-fetch</a> <em>(npmjs.com)</em></p>
<h2 id="references">References</h2>

<ul>
<li><a href="https://fetch.spec.whatwg.org/">https://fetch.spec.whatwg.org/</a></li>
<li><a href="https://www.npmjs.com/package/whatwg-fetch">https://www.npmjs.com/package/whatwg-fetch</a></li>
</ul>

</div>
</body>  
</html>