<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Q.js cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Q.js cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints/qjs.md" >edit</a>
  </div>
  <div class="toc">
<b>Main</b>: <a href="#intro">Intro</a>, <a href="#creating-promises-q-promise-">Creating promises (Q.promise)</a>, <a href="#for-arrays">For arrays</a>, <a href="#creating-promises-from-node">Creating promises from Node</a>, <a href="#promises-to-node-async">Promises to Node async</a>, <a href="#promise-sugars">Promise sugars</a>, <a href="#try">Try</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h3 id="intro">Intro</h3>
<p><a href="https://github.com/kriskowal/q/wiki/API-Reference">Q.js</a> is a JavaScript library for promises. </p>
<h3 id="creating-promises-q-promise-">Creating promises (Q.promise)</h3>

<pre><code><span class="hljs-module-access"><span class="hljs-module"><span class="hljs-identifier">Q</span>.</span></span>promise<span class="hljs-function"> (<span class="hljs-params">ok</span>, <span class="hljs-params">fail</span>) =&gt;</span>
  asyncFunction -&gt;
    <span class="hljs-keyword">if</span> error
      fail <span class="hljs-keyword">new</span> <span class="hljs-constructor">Error(<span class="hljs-string">&quot;Failure&quot;</span>)</span>
    <span class="hljs-keyword">else</span>
      ok(data)
</code></pre>
<h3 id="for-arrays">For arrays</h3>

<pre><code>promises = [saveDisk(), saveCloud()]

<span class="hljs-comment"># When all succeeds, or *at least one* error</span>
Q.all(promises).done -&gt;
  alert <span class="hljs-string">&quot;Saved&quot;</span>

<span class="hljs-comment"># Same, but get the values</span>
Q.all<span class="hljs-function"><span class="hljs-params">(promises)</span>.<span class="hljs-title">spread</span> <span class="hljs-params">(a, b)</span> -&gt;</span>
  alert <span class="hljs-string">&quot;Result A:&quot;</span> + a
  alert <span class="hljs-string">&quot;Result B:&quot;</span> + b

<span class="hljs-comment"># When all either succeeds or errors</span>
Q.allSettled(promises).done -&gt; ...
</code></pre>
<h3 id="creating-promises-from-node">Creating promises from Node</h3>

<pre><code># Works like .<span class="hljs-title function_ invoke__">call</span>() or .<span class="hljs-title function_ invoke__">apply</span>()

Q.<span class="hljs-title function_ invoke__">nfcall</span>(FS.readFile, <span class="hljs-symbol">&#x27;foo</span>.txt&#x27;, <span class="hljs-symbol">&#x27;utf</span>-<span class="hljs-number">8</span>&#x27;)
.then <span class="hljs-punctuation">-&gt;</span> ...

Q.<span class="hljs-title function_ invoke__">nfapply</span>(FS.readFile, [<span class="hljs-symbol">&#x27;foo</span>.txt&#x27;, <span class="hljs-symbol">&#x27;utf</span>-<span class="hljs-number">8</span>&#x27;])
.then <span class="hljs-punctuation">-&gt;</span> ...

Q.<span class="hljs-title function_ invoke__">npost</span>(FS, <span class="hljs-symbol">&#x27;readFile</span>&#x27;, [<span class="hljs-symbol">&#x27;foo</span>.txt, <span class="hljs-symbol">&#x27;utf</span>-<span class="hljs-number">8</span>&#x27;])
.then <span class="hljs-punctuation">-&gt;</span> ...

Q.<span class="hljs-title function_ invoke__">npost</span>(FS, <span class="hljs-symbol">&#x27;readFile</span>&#x27;, <span class="hljs-symbol">&#x27;foo</span>.txt, <span class="hljs-symbol">&#x27;utf</span>-<span class="hljs-number">8</span>&#x27;)
.then <span class="hljs-punctuation">-&gt;</span> ...

readFile = Q.<span class="hljs-title function_ invoke__">denodeify</span>(FS.readFile)
<span class="hljs-title function_ invoke__">readFile</span>(<span class="hljs-symbol">&#x27;foo</span>.txt&#x27;).then <span class="hljs-punctuation">-&gt;</span> ...
</code></pre>
<h3 id="promises-to-node-async">Promises to Node async</h3>

<pre><code><span class="hljs-function"><span class="hljs-title">createUser</span> = <span class="hljs-params">(<span class="hljs-built_in">next</span>)</span> -&gt;</span>
  promiseMaker()
  .nodeify(<span class="hljs-built_in">next</span>)
</code></pre>
<h3 id="promise-sugars">Promise sugars</h3>

<pre><code><span class="hljs-comment"># Shortcut for .then(ok, fail, progress)</span>
promise
.<span class="hljs-keyword">then</span> <span class="hljs-function"><span class="hljs-params">(data)</span> -&gt;</span>
.<span class="hljs-keyword">catch</span> <span class="hljs-function"><span class="hljs-params">(err)</span> -&gt;</span>
.progress <span class="hljs-function"><span class="hljs-params">(percent)</span> -&gt;</span>
</code></pre>
<h3 id="try">Try</h3>
<p>  Q.try -&gt;
    promise()</p>
<p>  .catch (e) -&gt;
    console.error &quot;Oh well&quot;, e</p>

</div>
</body>  
</html>