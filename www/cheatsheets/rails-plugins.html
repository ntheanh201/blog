<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Rails plugins cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Rails plugins cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints/rails-plugins.md" >edit</a>
  </div>
  <div class="toc">
<a href="#generate-a-plugin">Generate a plugin</a><br>
<a href="#initializers">Initializers</a><br>
<a href="#custom-routes">Custom routes</a><br>
<b>Custom generators</b>: <a href="#basic">Basic</a>, <a href="#generating-a-generator">Generating a generator</a>, <a href="#namedbase">NamedBase</a>, <a href="#more">More</a>, <a href="#generators-lookup">Generators lookup</a><br>
<a href="#activemodel-acts-as-">ActiveModel 'acts as'</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h2 id="generate-a-plugin">Generate a plugin</h2>
<p>Generate a Rails Engine plugin:</p>

<pre><code><span class="hljs-comment">rails plugin new myplugin </span>--<span class="hljs-comment">skip</span><span class="hljs-literal">-</span><span class="hljs-comment">bundle</span> --<span class="hljs-comment">full</span>
</code></pre>
<h2 id="initializers">Initializers</h2>

<ul>
<li><a href="http://edgeapi.rubyonrails.org/classes/Rails/Railtie.html">Rails::Railtie</a></li>
<li><a href="http://www.engineyard.com/blog/2010/extending-rails-3-with-railties/">EngineYard blog 
post</a></li>
</ul>
<p>Subclass Railtie and provide an <code>initializer</code> method.</p>

<pre><code><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">NewPlugin</span></span>
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Railtie</span> &lt; Rails::Railtie</span>
    initializer <span class="hljs-string">&quot;newplugin.initialize&quot;</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|app|</span>

      <span class="hljs-comment"># subscribe to all rails notifications: controllers, AR, etc.</span>
      ActiveSupport::Notifications.subscribe <span class="hljs-keyword">do</span> <span class="hljs-params">|*args|</span>
        event = ActiveSupport::Notifications::Event.new(*args)
        puts <span class="hljs-string">&quot;Got notification: <span class="hljs-subst">#{event.inspect}</span>&quot;</span>
      <span class="hljs-keyword">end</span>

    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2 id="custom-routes">Custom routes</h2>

<ul>
<li><a href="http://api.rubyonrails.org/classes/ActionDispatch/Routing/Mapper.html">ActionDispatch::Routing::Mapper</a></li>
</ul>
<p>To create custom <code>routes.rb</code> keywords:</p>

<pre><code># # routes.rb:
# myplugin_for x
#
<span class="hljs-keyword">class</span> <span class="hljs-symbol">ActionDispatch::<span class="hljs-symbol">Routing</span></span>
  <span class="hljs-symbol">class</span> <span class="hljs-symbol">Mapper</span>
    <span class="hljs-symbol">def</span> <span class="hljs-symbol">myplugin_for</span>(*<span class="hljs-symbol">x</span>)
    <span class="hljs-symbol">end</span>
  <span class="hljs-symbol">end</span>
<span class="hljs-symbol">end</span>
</code></pre>
<p>Example with a block:</p>

<pre><code><span class="hljs-comment"># authenticated do</span>
<span class="hljs-comment">#   resources :users</span>
<span class="hljs-comment"># end</span>
<span class="hljs-comment">#</span>
<span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">authenticated</span></span>
  constraint = <span class="hljs-built_in">lambda</span> { <span class="hljs-params">|request|</span> request... }

  constraints(constraint) { <span class="hljs-keyword">yield</span> }
<span class="hljs-keyword">end</span>
</code></pre>
<h2 id="custom-generators">Custom generators</h2>

<ul>
<li><a href="http://guides.rubyonrails.org/generators.html">Guide: generators</a></li>
<li><a href="http://api.rubyonrails.org/classes/ActiveRecord/Generators/Base.html">ActiveRecord::Generators::Base</a></li>
</ul>
<h3 id="basic">Basic</h3>

<pre><code><span class="hljs-meta"># rails g initializer</span>
<span class="hljs-meta"># lib/generators/initializer_generator.rb</span>
<span class="hljs-keyword">class</span> <span class="hljs-title class_">InitializerGenerator</span> &lt; Rails::Generators::Base
  def create_initializer_file
    create_file <span class="hljs-string">&quot;config/initializers/initializer.rb&quot;</span>, <span class="hljs-string">&quot;# Add initialization content here&quot;</span>
  end
end
</code></pre>

<ul>
<li>Extend <code>Rails::Generators::Base</code>.</li>
<li>Each public method in the generator is executed when a generator is invoked. </li>
</ul>
<h3 id="generating-a-generator">Generating a generator</h3>

<pre><code>$ rails <span class="hljs-keyword">generate</span> generator initializer
</code></pre>
<h3 id="namedbase">NamedBase</h3>
<p>Use <code>NamedBase</code> instead if you want to take an argument. It will be available as 
<code>file_name</code>.</p>

<pre><code><span class="hljs-keyword">class</span> <span class="hljs-symbol">InitializerGenerator</span> &lt; <span class="hljs-symbol">Rails::<span class="hljs-symbol">Generators</span>::<span class="hljs-symbol">Base</span></span>
  <span class="hljs-symbol">def</span> <span class="hljs-symbol">lol</span>
    <span class="hljs-symbol">puts</span> <span class="hljs-symbol">file_name</span>
  <span class="hljs-symbol">end</span>
<span class="hljs-symbol">end</span>
</code></pre>
<h3 id="more">More</h3>

<pre><code><span class="hljs-keyword">class</span> <span class="hljs-title class_">InitializerGenerator</span> &lt; Rails::Generators::NamedBase
  # 
  source_root <span class="hljs-built_in">File</span>.<span class="hljs-built_in">expand_path</span>(<span class="hljs-string">&quot;../templates&quot;</span>, __FILE__)
  desc <span class="hljs-string">&quot;Description goes here.&quot;</span>
end
</code></pre>
<h3 id="generators-lookup">Generators lookup</h3>
<p>When invoking <code>rails g XXX</code>:</p>

<pre><code>[rails<span class="hljs-regexp">/]generators/</span>XXX/XXX_generator.rb
[rails<span class="hljs-regexp">/]generators/</span>XXX_generator.rb
</code></pre>
<p>When invoking <code>rails g XXX:YYY</code>:</p>

<pre><code>[rails<span class="hljs-regexp">/]generators/</span>XXX/YYY_generator.rb
</code></pre>
<h2 id="activemodel-acts-as-">ActiveModel &#39;acts as&#39;</h2>

<pre><code><span class="hljs-comment"># yaffle/lib/yaffle/acts_as_yaffle.rb</span>
<span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">Yaffle</span></span>
  <span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">ActsAsYaffle</span></span>
    extend ActiveSupport::Concern

    included <span class="hljs-keyword">do</span>
    <span class="hljs-keyword">end</span>

    <span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">ClassMethods</span></span>
      <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">acts_as_yaffle</span><span class="hljs-params">(options = {})</span></span>
        <span class="hljs-comment"># your code will go here</span>
      <span class="hljs-keyword">end</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>

ActiveRecord::Base.send <span class="hljs-symbol">:include</span>, Yaffle::ActsAsYaffle
</code></pre>

</div>
</body>  
</html>