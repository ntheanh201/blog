<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Node.js streams cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Node.js streams cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints/nodejs-stream.md" >edit</a>
  </div>
  <div class="toc">
<b>Main</b>: <a href="#types">Types</a>, <a href="#streams">Streams</a>, <a href="#piping">Piping</a>, <a href="#methods">Methods</a>, <a href="#events">Events</a>, <a href="#flowing-mode">Flowing mode</a><br>
<b>Stream types</b>: <a href="#readable">Readable</a>, <a href="#transform">Transform</a>, <a href="#writable">Writable</a>, <a href="#all-together-now">All together now</a><br>
<a href="#also-see">Also see</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h3 id="types">Types</h3>

<table>
<thead>
<tr>
<th>Stream</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Readable</code></td>
<td>Data emitter</td>
</tr>
<tr>
<td><code>Writable</code></td>
<td>Data receiver</td>
</tr>
<tr>
<td><code>Transform</code></td>
<td>Emitter and receiver</td>
</tr>
<tr>
<td><code>Duplex</code></td>
<td>Emitter and receiver (independent)</td>
</tr>
</tbody>
</table>
<p>See: <a href="https://nodejs.org/api/stream.html#stream_stream">Stream</a> <em>(nodejs.org)</em></p>
<h3 id="streams">Streams</h3>

<pre><code class="js"><span class="hljs-keyword">const</span> <span class="hljs-title class_">Readable</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;stream&#x27;</span>).<span class="hljs-property">Readable</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Writable</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;stream&#x27;</span>).<span class="hljs-property">Writable</span>
<span class="hljs-keyword">const</span> <span class="hljs-title class_">Transform</span> = <span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;stream&#x27;</span>).<span class="hljs-property">Transform</span>
</code></pre>
<h3 id="piping">Piping</h3>

<pre><code class="js"><span class="hljs-title function_">clock</span>()              <span class="hljs-comment">// Readable stream</span>
  .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">xformer</span>())   <span class="hljs-comment">// Transform stream</span>
  .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">renderer</span>())  <span class="hljs-comment">// Writable stream</span>
</code></pre>
<h3 id="methods">Methods</h3>

<pre><code class="js">stream.<span class="hljs-title function_">push</span>(<span class="hljs-comment">/*...*/</span>)         <span class="hljs-comment">// Emit a chunk</span>
stream.<span class="hljs-title function_">emit</span>(<span class="hljs-string">&#x27;error&#x27;</span>, error)  <span class="hljs-comment">// Raise an error</span>
stream.<span class="hljs-title function_">push</span>(<span class="hljs-literal">null</span>)            <span class="hljs-comment">// Close a stream</span>
</code></pre>
<h3 id="events">Events</h3>

<pre><code class="js"><span class="hljs-keyword">const</span> st = <span class="hljs-title function_">source</span>()
st.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">data</span>) =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&lt;-&#x27;</span>, data) })
st.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;error&#x27;</span>, <span class="hljs-function">(<span class="hljs-params">err</span>) =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;!&#x27;</span>, err.<span class="hljs-property">message</span>) })
st.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;close&#x27;</span>, <span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;** bye&#x27;</span>) })
st.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;finish&#x27;</span>, <span class="hljs-function">() =&gt;</span> { <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;** bye&#x27;</span>) })
</code></pre>
<p>Assuming <code>source()</code> is a readable stream.</p>
<h3 id="flowing-mode">Flowing mode</h3>

<pre><code class="js"><span class="hljs-comment">// Toggle flowing mode</span>
st.<span class="hljs-title function_">resume</span>()
st.<span class="hljs-title function_">pause</span>()
</code></pre>

<pre><code class="js"><span class="hljs-comment">// Automatically turns on flowing mode</span>
st.<span class="hljs-title function_">on</span>(<span class="hljs-string">&#x27;data&#x27;</span>, <span class="hljs-comment">/*...*/</span>)
</code></pre>
<h2 id="stream-types">Stream types</h2>
<h3 id="readable">Readable</h3>

<pre><code class="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">clock</span> () {
  <span class="hljs-keyword">const</span> stream = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Readable</span>({
    <span class="hljs-attr">objectMode</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-title function_">read</span>(<span class="hljs-params"></span>) {}
  })

  <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> {
    stream.<span class="hljs-title function_">push</span>({ <span class="hljs-attr">time</span>: <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>() })
  }, <span class="hljs-number">1000</span>)

  <span class="hljs-keyword">return</span> stream
}

<span class="hljs-comment">// Implement read() if you</span>
<span class="hljs-comment">// need on-demand reading.</span>
</code></pre>
<p>Readable streams are generators of data. Write data using <code>stream.push()</code>.</p>
<h3 id="transform">Transform</h3>

<pre><code class="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">xformer</span> () {
  <span class="hljs-keyword">let</span> count = <span class="hljs-number">0</span>

  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Transform</span>({
    <span class="hljs-attr">objectMode</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">transform</span>: <span class="hljs-function">(<span class="hljs-params">data, _, done</span>) =&gt;</span> {
      <span class="hljs-title function_">done</span>(<span class="hljs-literal">null</span>, { ...data, <span class="hljs-attr">index</span>: count++ })
    }
  })
}
</code></pre>
<p>Pass the updated chunk to <code>done(null, chunk)</code>.</p>
<h3 id="writable">Writable</h3>

<pre><code class="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">renderer</span> () {
  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Writable</span>({
    <span class="hljs-attr">objectMode</span>: <span class="hljs-literal">true</span>,
    <span class="hljs-attr">write</span>: <span class="hljs-function">(<span class="hljs-params">data, _, done</span>) =&gt;</span> {
      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&#x27;&lt;-&#x27;</span>, data)
      <span class="hljs-title function_">done</span>()
    }
  })
}
</code></pre>
<h3 id="all-together-now">All together now</h3>

<pre><code class="js"><span class="hljs-title function_">clock</span>()              <span class="hljs-comment">// Readable stream</span>
  .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">xformer</span>())   <span class="hljs-comment">// Transform stream</span>
  .<span class="hljs-title function_">pipe</span>(<span class="hljs-title function_">renderer</span>())  <span class="hljs-comment">// Writable stream</span>
</code></pre>
<h2 id="also-see">Also see</h2>

<ul>
<li><a href="https://nodejs.org/api/stream.html">https://nodejs.org/api/stream.html</a></li>
<li><a href="https://github.com/substack/stream-handbook">https://github.com/substack/stream-handbook</a></li>
</ul>

</div>
</body>  
</html>