<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>RSpec cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / RSpec cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints\rspec.md" >edit</a>
  </div>
  <div class="toc">
<b>Main</b>: <a href="#invoking-tests">Invoking tests</a><br>
<b>Writing tests</b>: <a href="#before-after">Before/after</a>, <a href="#subjects">Subjects</a><br>
<b>Expectations</b>: <a href="#numeric">Numeric</a>, <a href="#comparison">Comparison</a>, <a href="#predicate">Predicate</a>, <a href="#objects">Objects</a>, <a href="#control-flow">Control flow</a>, <a href="#enumerables-arrays">Enumerables/arrays</a>, <a href="#change">Change</a><br>
<b>Doubles</b>: <a href="#method-stubs">Method stubs</a><br>
<a href="#spec-helpers">Spec helpers</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h3 id="invoking-tests">Invoking tests</h3>

<pre><code class="sh">rake -T spec      <span class="hljs-comment"># List spec tasks</span>

rake spec         <span class="hljs-comment"># Run all</span>

rake spec/models/mymodel_spec.rb
rake spec/models/mymodel_spec.rb:27
</code></pre>
<h2 id="writing-tests">Writing tests</h2>

<pre><code class="rb">describe <span class="hljs-string">&quot;A User (in general)&quot;</span> <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">include</span> UserSpecHelper

  subject { Person.new }

  let(<span class="hljs-symbol">:admin</span>) { Person.new(<span class="hljs-symbol">role:</span> <span class="hljs-symbol">:admin</span>) }

  context <span class="hljs-string">&quot;setter methods&quot;</span> <span class="hljs-keyword">do</span>
    it <span class="hljs-string">&quot;should do this&quot;</span> <span class="hljs-keyword">do</span>
      pending <span class="hljs-string">&quot;some other thing&quot;</span>

      expect(subject.name).to eq <span class="hljs-string">&#x27;x&#x27;</span>
    <span class="hljs-keyword">end</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3 id="before-after">Before/after</h3>

<pre><code class="rb">before <span class="hljs-symbol">:each</span> <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># before all tests</span>
<span class="hljs-keyword">end</span>

before <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># before this suite</span>
<span class="hljs-keyword">end</span>

after <span class="hljs-keyword">do</span>
  <span class="hljs-comment"># after this suite</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3 id="subjects">Subjects</h3>

<pre><code class="rb">subject { CheckingAccount.new }
it { is_expected.to be_empty }

<span class="hljs-comment"># also names: subject(:account) { ... }</span>
</code></pre>
<h2 id="expectations">Expectations</h2>

<pre><code class="rb">target.should eq <span class="hljs-number">1</span>
target.should_not eq <span class="hljs-number">1</span>

expect(target).to eq <span class="hljs-number">1</span>
expect(target).not_to eq <span class="hljs-number">1</span>
</code></pre>
<h3 id="numeric">Numeric</h3>

<pre><code class="rb">expect(<span class="hljs-number">5</span>).to be &lt; <span class="hljs-number">6</span>
expect(<span class="hljs-number">5</span>).to == <span class="hljs-number">5</span>
expect(<span class="hljs-number">5</span>).to equal value
expect(<span class="hljs-number">5</span>).to be_between(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>)
expect(<span class="hljs-number">5</span>).to be_within(<span class="hljs-number">0.05</span>).of value
</code></pre>
<h3 id="comparison">Comparison</h3>

<pre><code class="rb">expect(x).to be value
expect(x).to satisfy { <span class="hljs-params">|arg|</span> ... }
expect(x).to match /regexp/
</code></pre>
<h3 id="predicate">Predicate</h3>

<pre><code class="rb">expect(x).to be_zero    <span class="hljs-comment"># FixNum#zero?</span>
expect(x).to be_empty   <span class="hljs-comment"># Array#empty?</span>
expect(x).to have_key   <span class="hljs-comment"># Hash#has_key?</span>
</code></pre>
<h3 id="objects">Objects</h3>

<pre><code class="rb">expect(obj).to be_an_instance_of MyClass
expect(obj).to be_a_kind_of MyClass
expect(obj).to respond_to <span class="hljs-symbol">:save!</span>
</code></pre>
<h3 id="control-flow">Control flow</h3>

<pre><code class="rb">expect { user.save! }.to raise_error
expect { user.save! }.to raise_error(ExceptionName, <span class="hljs-regexp">/msg/</span>)
expect { user.save! }.to throw <span class="hljs-symbol">:symbol</span>
</code></pre>
<h3 id="enumerables-arrays">Enumerables/arrays</h3>

<pre><code class="rb">expect(list).to <span class="hljs-keyword">include</span>(&lt;object&gt;)

expect(list).to have(<span class="hljs-number">1</span>).things
expect(list).to have_at_least(<span class="hljs-number">2</span>).things
expect(list).to have_at_most(<span class="hljs-number">3</span>).things

expect(list).to have(<span class="hljs-number">2</span>).errors_on(<span class="hljs-symbol">:field</span>)
</code></pre>
<h3 id="change">Change</h3>

<pre><code class="rb">expect { thing.approve! }.to \
  change(thing, <span class="hljs-symbol">:status</span>)
  .from(Status::AWAITING_APPROVAL)
  .to(Status::APPROVED)

expect { thing.destroy }.to \
  change(Thing, <span class="hljs-symbol">:count</span>)
  .by(-<span class="hljs-number">1</span>)
</code></pre>
<h2 id="doubles">Doubles</h2>

<pre><code class="rb">book = double(<span class="hljs-string">&#x27;book&#x27;</span>)
book = instance_double(<span class="hljs-string">&#x27;Book&#x27;</span>, <span class="hljs-symbol">pages:</span> <span class="hljs-number">250</span>)
</code></pre>
<h3 id="method-stubs">Method stubs</h3>

<pre><code class="rb">allow(die).to receive(<span class="hljs-symbol">:roll</span>)
allow(die).to receive(<span class="hljs-symbol">:roll</span>) { <span class="hljs-number">3</span> }
allow_any_instance_of(Die).to receive(<span class="hljs-symbol">:roll</span>)

expect(die).to receive(<span class="hljs-symbol">:roll</span>)
  .with(<span class="hljs-number">1</span>)
  .with(<span class="hljs-number">1</span>, <span class="hljs-literal">true</span>)
  .with(boolean)
  .with(anything)
  .with(any_args)
  .with(<span class="hljs-number">1</span>, any_args)
  .with(no_args)
  .with(hash_including(<span class="hljs-symbol">a:</span> <span class="hljs-number">1</span>))
  .with(hash_excluding(<span class="hljs-symbol">a:</span> <span class="hljs-number">1</span>))
  .with(array_including(<span class="hljs-symbol">:a</span>, <span class="hljs-symbol">:b</span>))
  .with(array_excluding(<span class="hljs-symbol">:a</span>, <span class="hljs-symbol">:b</span>))
  .with(instance_of(Fixnum))
  .with(kind_of(Numeric))
  .with(&lt;matcher&gt;)

  .once
  .twice
  .exactly(n).times
  .at_least(<span class="hljs-symbol">:once</span>)
  .at_least(<span class="hljs-symbol">:twice</span>)
  .at_least(n).times
  .at_most(<span class="hljs-symbol">:once</span>)
  .at_most(<span class="hljs-symbol">:twice</span>)
  .at_most(n).times
</code></pre>
<p><a href="https://relishapp.com/rspec/rspec-mocks/docs">https://relishapp.com/rspec/rspec-mocks/docs</a></p>
<h2 id="spec-helpers">Spec helpers</h2>

<pre><code class="rb"><span class="hljs-class"><span class="hljs-keyword">module</span> <span class="hljs-title">UserSpecHelper</span></span>
  <span class="hljs-function"><span class="hljs-keyword">def</span> <span class="hljs-title">valid_user_attributes</span></span>
    { <span class="hljs-symbol">:email</span> =&gt; <span class="hljs-string">&quot;joe@bloggs.com&quot;</span>,
      <span class="hljs-symbol">:username</span> =&gt; <span class="hljs-string">&quot;joebloggs&quot;</span>,
      <span class="hljs-symbol">:password</span> =&gt; <span class="hljs-string">&quot;abcdefg&quot;</span>}
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>

<pre><code class="rb">describe User <span class="hljs-keyword">do</span>
  <span class="hljs-keyword">include</span> UserSpecHelper

  ...
<span class="hljs-keyword">end</span>
</code></pre>

</div>
</body>  
</html>