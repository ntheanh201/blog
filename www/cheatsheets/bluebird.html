<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>bluebird.js cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / bluebird.js cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints\bluebird.md" >edit</a>
  </div>
  <div class="toc">
<b>Main</b>: <a href="#also-see">Also see</a>, <a href="#example">Example</a>, <a href="#multiple-return-values">Multiple return values</a>, <a href="#multiple-promises">Multiple promises</a>, <a href="#multiple-promises-array-">Multiple promises (array)</a>, <a href="#object">Object</a>, <a href="#chain-of-promises">Chain of promises</a>, <a href="#node-style-functions">Node-style functions</a>, <a href="#promise-returning-methods">Promise-returning methods</a>, <a href="#generators">Generators</a><br>
<a href="#reference">Reference</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h3 id="also-see">Also see</h3>
<p>Also see the <a href="promise.html">promise cheatsheet</a> and <a href="https://github.com/petkaantonov/bluebird/blob/master/API.md">Bluebird.js API</a> (github.com).</p>
<h3 id="example">Example</h3>

<pre><code class="js">promise
  .<span class="hljs-title function_">then</span>(okFn, errFn)
  .<span class="hljs-title function_">spread</span>(okFn, errFn)        <span class="hljs-comment">// *</span>
  .<span class="hljs-title function_">catch</span>(errFn)
  .<span class="hljs-title function_">catch</span>(<span class="hljs-title class_">TypeError</span>, errFn)    <span class="hljs-comment">// *</span>
  .<span class="hljs-title function_">finally</span>(fn)
  .<span class="hljs-title function_">map</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) { ··· })  <span class="hljs-comment">// *</span>
  .<span class="hljs-title function_">each</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">e</span>) { ··· }) <span class="hljs-comment">// *</span>
</code></pre>
<p>Those marked with <code>*</code> are non-standard Promise API that only work with Bluebird promises.</p>
<h3 id="multiple-return-values">Multiple return values</h3>

<pre><code class="js">.<span class="hljs-title function_">then</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> [ <span class="hljs-string">&#x27;abc&#x27;</span>, <span class="hljs-string">&#x27;def&#x27;</span> ]
})
.<span class="hljs-title function_">spread</span>(<span class="hljs-keyword">function</span> (<span class="hljs-params">abc, def</span>) {
  ···
})
</code></pre>
<p>Use <a href="http://bluebirdjs.com/docs/api/promise.spread.html">Promise.spread</a></p>
<h3 id="multiple-promises">Multiple promises</h3>

<pre><code class="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">join</span>(
  <span class="hljs-title function_">getPictures</span>(),
  <span class="hljs-title function_">getMessages</span>(),
  <span class="hljs-title function_">getTweets</span>(),
  <span class="hljs-keyword">function</span> (<span class="hljs-params">pics, msgs, tweets</span>) {
    <span class="hljs-keyword">return</span> ···
  }
)
</code></pre>
<p>Use <a href="http://bluebirdjs.com/docs/api/promise.join.html">Promise.join</a></p>
<h3 id="multiple-promises-array-">Multiple promises (array)</h3>

<ul>
<li><a href="http://bluebirdjs.com/docs/api/promise.all.html">Promise.all</a>([p]) - expect all to pass</li>
<li><a href="http://bluebirdjs.com/docs/api/promise.some.html">Promise.some</a>([p], count) - expect <code>count</code> to pass</li>
<li><a href="http://bluebirdjs.com/docs/api/promise.any.html">Promise.any</a>([p]) - same as <code>some([p], 1)</code></li>
<li><a href="http://bluebirdjs.com/docs/api/promise.race.html">Promise.race</a>([p], count) - use <code>.any</code> instead</li>
<li><a href="http://bluebirdjs.com/docs/api/promise.map.html">Promise.map</a>([p], fn, options) - supports concurrency</li>
</ul>

<pre><code class="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">all</span>([ promise1, promise2 ])
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
    results[<span class="hljs-number">0</span>]
    results[<span class="hljs-number">1</span>]
  })

<span class="hljs-comment">// succeeds if one succeeds first</span>
<span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">any</span>(promises)
  .<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">results</span> =&gt;</span> {
  })
</code></pre>

<pre><code class="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">map</span>(urls, <span class="hljs-function"><span class="hljs-params">url</span> =&gt;</span> <span class="hljs-title function_">fetch</span>(url))
  .<span class="hljs-title function_">then</span>(···)
</code></pre>
<p>Use <a href="http://bluebirdjs.com/docs/api/promise.map.html">Promise.map</a> to &quot;promisify&quot; a list of values.</p>
<h3 id="object">Object</h3>

<pre><code class="js"><span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">props</span>({
  <span class="hljs-attr">photos</span>: <span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;photos&#x27;</span>),
  <span class="hljs-attr">posts</span>: <span class="hljs-title function_">get</span>(<span class="hljs-string">&#x27;posts&#x27;</span>)
})
.<span class="hljs-title function_">then</span>(<span class="hljs-function"><span class="hljs-params">res</span> =&gt;</span> {
  res.<span class="hljs-property">photos</span>
  res.<span class="hljs-property">posts</span>
})
</code></pre>
<p>Use <a href="http://bluebirdjs.com/docs/api/promise.props.html">Promise.props</a>.</p>
<h3 id="chain-of-promises">Chain of promises</h3>

<pre><code class="js"><span class="hljs-keyword">function</span> <span class="hljs-title function_">getPhotos</span>(<span class="hljs-params"></span>) {
  <span class="hljs-keyword">return</span> <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">try</span>(<span class="hljs-function">() =&gt;</span> {
    <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;boo&quot;</span>)
    <span class="hljs-keyword">return</span> result
  })
}

<span class="hljs-title function_">getPhotos</span>().<span class="hljs-title function_">then</span>(···)
</code></pre>
<p>Use <a href="http://bluebirdjs.com/docs/api/promise.try.html">Promise.try</a>.</p>
<h3 id="node-style-functions">Node-style functions</h3>

<pre><code class="js"><span class="hljs-keyword">var</span> readFile = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">promisify</span>(fs.<span class="hljs-property">readFile</span>)
<span class="hljs-keyword">var</span> fs = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">promisifyAll</span>(<span class="hljs-built_in">require</span>(<span class="hljs-string">&#x27;fs&#x27;</span>))
</code></pre>
<p>See <a href="http://bluebirdjs.com/docs/api/promisification.html">Promisification</a>.</p>
<h3 id="promise-returning-methods">Promise-returning methods</h3>

<pre><code class="js"><span class="hljs-title class_">User</span>.<span class="hljs-property">login</span> = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">method</span>(<span class="hljs-function">(<span class="hljs-params">email, password</span>) =&gt;</span> {
  <span class="hljs-keyword">if</span> (!valid)
    <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Error</span>(<span class="hljs-string">&quot;Email not valid&quot;</span>)

  <span class="hljs-keyword">return</span> <span class="hljs-comment">/* promise */</span>
})
</code></pre>
<p>See <a href="http://bluebirdjs.com/docs/api/promise.method.html">Promise.method</a>.</p>
<h3 id="generators">Generators</h3>

<pre><code class="js"><span class="hljs-title class_">User</span>.<span class="hljs-property">login</span> = <span class="hljs-title class_">Promise</span>.<span class="hljs-title function_">coroutine</span>(<span class="hljs-keyword">function</span>* (email, password) {
  <span class="hljs-keyword">let</span> user = <span class="hljs-keyword">yield</span> <span class="hljs-title class_">User</span>.<span class="hljs-title function_">find</span>({<span class="hljs-attr">email</span>: email}).<span class="hljs-title function_">fetch</span>()
  <span class="hljs-keyword">return</span> user
})
</code></pre>
<p>See <a href="http://bluebirdjs.com/docs/api/promise.coroutine.html">Promise.coroutine</a>.</p>
<h2 id="reference">Reference</h2>
<p><a href="http://bluebirdjs.com/docs/api-reference.html">http://bluebirdjs.com/docs/api-reference.html</a></p>

</div>
</body>  
</html>