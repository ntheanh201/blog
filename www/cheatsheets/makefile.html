<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Makefile cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Makefile cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints/makefile.md" >edit</a>
  </div>
  <div class="toc">
<a href="#var-assignment">Var assignment</a><br>
<a href="#magic-variables">Magic variables</a><br>
<a href="#command-prefixes">Command prefixes</a><br>
<a href="#find-files">Find files</a><br>
<a href="#substitutions">Substitutions</a><br>
<a href="#more-functions">More functions</a><br>
<a href="#building-files">Building files</a><br>
<a href="#includes">Includes</a><br>
<a href="#options">Options</a><br>
<a href="#conditionals">Conditionals</a><br>
<a href="#recursive">Recursive</a><br>
<a href="#further-reading">Further reading</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h2 id="var-assignment">Var assignment</h2>

<pre><code class="makefile">foo  = <span class="hljs-string">&quot;bar&quot;</span>
bar  = <span class="hljs-variable">$(foo)</span> foo  <span class="hljs-comment"># dynamic (renewing) assignment</span>
foo := <span class="hljs-string">&quot;boo&quot;</span>       <span class="hljs-comment"># one time assignment, $(bar) now is &quot;boo foo&quot;</span>
foo ?= /usr/local  <span class="hljs-comment"># safe assignment, $(foo) and $(bar) still the same</span>
bar += world       <span class="hljs-comment"># append, &quot;boo foo world&quot;</span>
foo != echo fooo   <span class="hljs-comment"># exec shell command and assign to foo</span>
<span class="hljs-comment"># $(bar) now is &quot;fooo foo world&quot;</span>
</code></pre>
<p><code>=</code> expressions are only evaluated when they&#39;re being used.</p>
<h2 id="magic-variables">Magic variables</h2>

<pre><code class="makefile"><span class="hljs-section">out.o: src.c src.h</span>
  <span class="hljs-variable">$@</span>   <span class="hljs-comment"># &quot;out.o&quot; (target)</span>
  <span class="hljs-variable">$&lt;</span>   <span class="hljs-comment"># &quot;src.c&quot; (first prerequisite)</span>
  <span class="hljs-variable">$^</span>   <span class="hljs-comment"># &quot;src.c src.h&quot; (all prerequisites)</span>

<span class="hljs-section">%.o: %.c</span>
  <span class="hljs-variable">$*</span>   <span class="hljs-comment"># the &#x27;stem&#x27; with which an implicit rule matches (&quot;foo&quot; in &quot;foo.c&quot;)</span>

<span class="hljs-section">also:</span>
  <span class="hljs-variable">$+</span>   <span class="hljs-comment"># prerequisites (all, with duplication)</span>
  <span class="hljs-variable">$?</span>   <span class="hljs-comment"># prerequisites (new ones)</span>
  $|   <span class="hljs-comment"># prerequisites (order-only?)</span>

  $(@D) <span class="hljs-comment"># target directory</span>
</code></pre>
<h2 id="command-prefixes">Command prefixes</h2>

<table>
<thead>
<tr>
<th>Prefix</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>-</code></td>
<td>Ignore errors</td>
</tr>
<tr>
<td><code>@</code></td>
<td>Don&#39;t print command</td>
</tr>
<tr>
<td><code>+</code></td>
<td>Run even if Make is in &#39;don&#39;t execute&#39; mode</td>
</tr>
</tbody>
</table>

<pre><code class="makefile"><span class="hljs-section">build:</span>
    @echo <span class="hljs-string">&quot;compiling&quot;</span>
    -gcc <span class="hljs-variable">$&lt;</span> <span class="hljs-variable">$@</span>

<span class="hljs-keyword">-include</span> .depend
</code></pre>
<h2 id="find-files">Find files</h2>

<pre><code class="makefile">js_files  := <span class="hljs-variable">$(<span class="hljs-built_in">wildcard</span> test/*.js)</span>
all_files := <span class="hljs-variable">$(<span class="hljs-built_in">shell</span> find images -name &quot;*&quot;)</span>
</code></pre>
<h2 id="substitutions">Substitutions</h2>

<pre><code class="makefile">file     = $(SOURCE:.cpp=.o)   <span class="hljs-comment"># foo.cpp =&gt; foo.o</span>
outputs  = $(files:src/%.coffee=lib/%.js)

outputs  = <span class="hljs-variable">$(<span class="hljs-built_in">patsubst</span> %.c, %.o, $(<span class="hljs-built_in">wildcard</span> *.c)</span>)
assets   = <span class="hljs-variable">$(<span class="hljs-built_in">patsubst</span> images/%, assets/%, $(<span class="hljs-built_in">wildcard</span> images/*)</span>)
</code></pre>
<h2 id="more-functions">More functions</h2>

<pre><code class="makefile"><span class="hljs-variable">$(<span class="hljs-built_in">strip</span> <span class="hljs-variable">$(string_var)</span>)</span>

<span class="hljs-variable">$(<span class="hljs-built_in">filter</span> %.less, <span class="hljs-variable">$(files)</span>)</span>
<span class="hljs-variable">$(<span class="hljs-built_in">filter</span>-out %.less, <span class="hljs-variable">$(files)</span>)</span>
</code></pre>
<h2 id="building-files">Building files</h2>

<pre><code class="makefile"><span class="hljs-section">%.o: %.c</span>
  ffmpeg -i <span class="hljs-variable">$&lt;</span> &gt; <span class="hljs-variable">$@</span>   <span class="hljs-comment"># Input and output</span>
  foo <span class="hljs-variable">$^</span>
</code></pre>
<h2 id="includes">Includes</h2>

<pre><code class="makefile"><span class="hljs-keyword">-include</span> foo.make
</code></pre>
<h2 id="options">Options</h2>

<pre><code class="sh">make
  -e, --environment-overrides
  -B, --always-make
  -s, --silent
  -j, --<span class="hljs-built_in">jobs</span>=N   <span class="hljs-comment"># parallel processing</span>
</code></pre>
<h2 id="conditionals">Conditionals</h2>

<pre><code class="makefile"><span class="hljs-section">foo: <span class="hljs-variable">$(objects)</span></span>
<span class="hljs-keyword">ifeq</span> (<span class="hljs-variable">$(CC)</span>,gcc)
  <span class="hljs-variable">$(CC)</span> -o foo <span class="hljs-variable">$(objects)</span> <span class="hljs-variable">$(libs_for_gcc)</span>
<span class="hljs-keyword">else</span>
  <span class="hljs-variable">$(CC)</span> -o foo <span class="hljs-variable">$(objects)</span> <span class="hljs-variable">$(normal_libs)</span>
<span class="hljs-keyword">endif</span>
</code></pre>
<h2 id="recursive">Recursive</h2>

<pre><code class="makefile"><span class="hljs-section">deploy:</span>
  <span class="hljs-variable">$(MAKE)</span> deploy2
</code></pre>
<h2 id="further-reading">Further reading</h2>

<ul>
<li><a href="https://gist.github.com/isaacs/62a2d1825d04437c6f08">isaacs&#39;s Makefile</a></li>
<li><a href="https://tech.davis-hansson.com/p/make/">Your Makefiles are wrong</a></li>
<li><a href="https://www.gnu.org/software/make/manual/html_node/index.html">Manual</a></li>
</ul>

</div>
</body>  
</html>