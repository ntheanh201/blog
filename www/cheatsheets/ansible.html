<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Ansible cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Ansible cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints\ansible.md" >edit</a>
  </div>
  <div class="toc">
<b>Getting started</b>: <a href="#hosts">Hosts</a>, <a href="#running-a-playbook">Running a playbook</a><br>
<b>Tasks</b>: <a href="#includes">Includes</a><br>
<a href="#handlers">Handlers</a><br>
<a href="#vars">Vars</a><br>
<b>Roles</b>: <a href="#task-failures">Task: Failures</a>, <a href="#env-vars">Env vars</a><br>
<a href="#references">References</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h2 id="getting-started">Getting started</h2>
<h3 id="hosts">Hosts</h3>

<pre><code>$ sudo mkdir /etc/ansible
$ sudo vim /etc/ansible/hosts

<span class="hljs-string">[example]</span>
<span class="hljs-number">192.0.2.101</span>
<span class="hljs-number">192.0.2.102</span>
</code></pre>
<h3 id="running-a-playbook">Running a playbook</h3>

<pre><code><span class="hljs-variable">$ </span>ansible-playbook playbook.yml
</code></pre>
<h2 id="tasks">Tasks</h2>

<pre><code><span class="hljs-bullet">-</span> <span class="hljs-string">hosts: all</span>
  <span class="hljs-attribute">user</span><span class="hljs-punctuation">:</span> <span class="hljs-string">root</span>
  <span class="hljs-attribute">sudo</span><span class="hljs-punctuation">:</span> <span class="hljs-string">no</span>
  <span class="hljs-attribute">vars</span><span class="hljs-punctuation">:</span>
    <span class="hljs-attribute">aaa</span><span class="hljs-punctuation">:</span> <span class="hljs-string">bbb</span>
  <span class="hljs-attribute">tasks</span><span class="hljs-punctuation">:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">...</span>
  <span class="hljs-attribute">handlers</span><span class="hljs-punctuation">:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">...</span>
</code></pre>
<h3 id="includes">Includes</h3>

<pre><code><span class="hljs-section">tasks:</span>
  - <span class="hljs-keyword">include</span>: db.yml
<span class="hljs-section">handlers:</span>
  - <span class="hljs-keyword">include</span>: db.yml user=timmy
</code></pre>
<h2 id="handlers">Handlers</h2>

<pre><code>handlers:
  - name: start apache2
    action: service name=apache2 <span class="hljs-keyword">state</span>=started

tasks:
  - name: install apache
    action: apt pkg=apache2 <span class="hljs-keyword">state</span>=latest
    notify:
      - start apache2
</code></pre>
<h2 id="vars">Vars</h2>

<pre><code>- host: lol
<span class="hljs-symbol">  vars_files:</span>
    - vars.yml
<span class="hljs-symbol">  vars:</span>
<span class="hljs-symbol">    project_root:</span> <span class="hljs-keyword">/etc/</span>xyz
<span class="hljs-symbol">  tasks:</span>
    - name: Create the SSH directory.
<span class="hljs-symbol">      file:</span> <span class="hljs-attr">state</span><span class="hljs-operator">=</span>directory <span class="hljs-attr">path</span><span class="hljs-operator">=</span>$<span class="hljs-punctuation">{</span>project_root<span class="hljs-punctuation">}</span><span class="hljs-keyword">/home/</span>.ssh/
<span class="hljs-symbol">      only_if:</span> <span class="hljs-string">&quot;$vm == 0&quot;</span>
</code></pre>
<h2 id="roles">Roles</h2>

<pre><code><span class="hljs-bullet">-</span> <span class="hljs-string">host: xxx</span>
  <span class="hljs-attribute">roles</span><span class="hljs-punctuation">:</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">db</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">{ role:ruby, sudo_user:$user }</span>
    <span class="hljs-bullet">-</span> <span class="hljs-string">web</span>

<span class="hljs-comment"># Uses:</span>
<span class="hljs-comment"># roles/db/tasks/*.yml</span>
<span class="hljs-comment"># roles/db/handlers/*.yml</span>
</code></pre>
<h3 id="task-failures">Task: Failures</h3>

<pre><code>- name: my task
<span class="hljs-symbol">  command:</span> ...
<span class="hljs-symbol">  register:</span> result
<span class="hljs-symbol">  failed_when:</span> <span class="hljs-string">&quot;&#x27;FAILED&#x27; in result.stderr&quot;</span>
<span class="hljs-symbol">
  ignore_errors:</span> yes
<span class="hljs-symbol">
  changed_when:</span> <span class="hljs-string">&quot;result.rc != 2&quot;</span>
</code></pre>
<h3 id="env-vars">Env vars</h3>

<pre><code><span class="language-xml">vars:
  local_home: &quot;</span><span class="hljs-template-variable">{{ <span class="hljs-name"><span class="hljs-built_in">lookup</span></span>(<span class="hljs-name">&#x27;env&#x27;</span>,<span class="hljs-string">&#x27;HOME&#x27;</span>) }}</span><span class="language-xml">&quot;</span>
</code></pre>
<h2 id="references">References</h2>

<ul>
<li><a href="http://www.ansibleworks.com/docs/intro_configuration.html">Intro</a></li>
<li><a href="http://www.ansibleworks.com/docs/modules.html">Modules</a></li>
</ul>

</div>
</body>  
</html>