<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Factory Bot cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Factory Bot cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints\factory_bot.md" >edit</a>
  </div>
  <div class="toc">
<b>Factories</b>: <a href="#introduction">Introduction</a>, <a href="#defining-factories">Defining factories</a>, <a href="#extra-options">Extra options</a>, <a href="#using">Using</a><br>
<b>Associations</b>: <a href="#defining">Defining</a>, <a href="#after-create-hooks">After-create hooks</a><br>
<b>Other features</b>: <a href="#traits">Traits</a>, <a href="#nested-factories">Nested factories</a>, <a href="#sub-factories">Sub-factories</a>, <a href="#options-transients-">Options (transients)</a>, <a href="#paths">Paths</a><br>
<a href="#see-also">See also</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h2 id="factories">Factories</h2>
<h3 id="introduction">Introduction</h3>
<p><a href="http://www.rubydoc.info/gems/factory_bot/">Factory Bot</a> is a helper for writing factories for Ruby tests. It was previously known as Factory Girl. For older versions, use <code>FactoryGirl</code> instead of <code>FactoryBot</code>.</p>

<ul>
<li><a href="http://www.rubydoc.info/gems/factory_bot/">Factory Bot documentation</a> <em>(rubydoc.info)</em></li>
<li><a href="https://github.com/thoughtbot/factory_bot/blob/master/GETTING_STARTED.md">Getting started</a> <em>(github.com)</em></li>
<li><a href="https://github.com/thoughtbot/factory_bot">Source code</a> <em>(github.com)</em></li>
</ul>
<h3 id="defining-factories">Defining factories</h3>

<pre><code class="ruby">FactoryBot.define <span class="hljs-keyword">do</span>
  factory <span class="hljs-symbol">:user</span> <span class="hljs-keyword">do</span>
    first_name { <span class="hljs-string">&#x27;John&#x27;</span> }
    last_name  { <span class="hljs-string">&#x27;Doe&#x27;</span> }
    birthdate  { <span class="hljs-number">21</span>.years.ago }
    admin { <span class="hljs-literal">false</span> }

    sequence(<span class="hljs-symbol">:username</span>) { <span class="hljs-params">|n|</span> <span class="hljs-string">&quot;user<span class="hljs-subst">#{n}</span>&quot;</span> }
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<p>See: <a href="http://www.rubydoc.info/gems/factory_bot/file/GETTING_STARTED.md#Defining_factories">Defining factories</a></p>
<h3 id="extra-options">Extra options</h3>
<h4 id="custom-class-names">Custom class names</h4>

<pre><code class="ruby">factory <span class="hljs-symbol">:user</span>, <span class="hljs-class"><span class="hljs-keyword">class</span>: &#x27;<span class="hljs-title">User</span>&#x27; <span class="hljs-title">do</span></span>
  ···
<span class="hljs-keyword">end</span>
</code></pre>
<h4 id="aliases">Aliases</h4>

<pre><code class="ruby">factory <span class="hljs-symbol">:user</span>, <span class="hljs-symbol">aliases:</span> [<span class="hljs-symbol">:author</span>] <span class="hljs-keyword">do</span>
  ···
<span class="hljs-keyword">end</span>
</code></pre>
<h3 id="using">Using</h3>
<h4 id="build-a-model">Build a model</h4>

<pre><code class="ruby">FactoryBot.build(<span class="hljs-symbol">:user</span>)
</code></pre>
<h4 id="other-ways">Other ways</h4>

<pre><code class="ruby">build(<span class="hljs-symbol">:user</span>)           <span class="hljs-comment"># → model (not saved)</span>
create(<span class="hljs-symbol">:user</span>)          <span class="hljs-comment"># → model (saved)</span>
attributes_for(<span class="hljs-symbol">:user</span>)  <span class="hljs-comment"># → hash</span>
build_stubbed(<span class="hljs-symbol">:user</span>)   <span class="hljs-comment"># stubbed out attributes</span>
</code></pre>
<h4 id="with-options">With options</h4>

<pre><code class="ruby">build(<span class="hljs-symbol">:user</span>, <span class="hljs-symbol">name:</span> <span class="hljs-string">&#x27;John&#x27;</span>)
</code></pre>
<h4 id="lists">Lists</h4>

<pre><code class="ruby">create_list(<span class="hljs-symbol">:user</span>, <span class="hljs-number">3</span>)
build_list(<span class="hljs-symbol">:user</span>, <span class="hljs-number">3</span>)
</code></pre>
<h2 id="associations">Associations</h2>
<h3 id="defining">Defining</h3>

<pre><code class="ruby">factory <span class="hljs-symbol">:post</span> <span class="hljs-keyword">do</span>
  association <span class="hljs-symbol">:author</span>, <span class="hljs-symbol">factory:</span> <span class="hljs-symbol">:user</span>
  association <span class="hljs-symbol">:author</span>, <span class="hljs-symbol">factory:</span> [<span class="hljs-symbol">:user</span>, <span class="hljs-symbol">:admin</span>]
<span class="hljs-keyword">end</span>
</code></pre>
<h4 id="or">or</h4>

<pre><code class="ruby">factory <span class="hljs-symbol">:post</span> <span class="hljs-keyword">do</span>
  author  <span class="hljs-comment"># assumes there&#x27;s a factory :author</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h3 id="after-create-hooks">After-create hooks</h3>

<pre><code class="ruby">factory <span class="hljs-symbol">:post</span> <span class="hljs-keyword">do</span>
  after <span class="hljs-symbol">:create</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|post|</span>
    create <span class="hljs-symbol">:theme</span>, <span class="hljs-symbol">post:</span> post             <span class="hljs-comment"># has_one</span>
    create_list <span class="hljs-symbol">:comment</span>, <span class="hljs-number">3</span>, <span class="hljs-symbol">post:</span> post   <span class="hljs-comment"># has_many</span>
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>
<h2 id="other-features">Other features</h2>
<h3 id="traits">Traits</h3>

<pre><code class="ruby">factory <span class="hljs-symbol">:user</span> <span class="hljs-keyword">do</span>
  trait <span class="hljs-symbol">:admin</span> <span class="hljs-keyword">do</span>
    admin { <span class="hljs-literal">true</span> }
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>

<pre><code class="ruby">create <span class="hljs-symbol">:user</span>, <span class="hljs-symbol">:admin</span>
</code></pre>
<p>Traits allow you to group attributes together.
See: <a href="http://www.rubydoc.info/gems/factory_bot/file/GETTING_STARTED.md#Traits">Traits</a></p>
<h3 id="nested-factories">Nested factories</h3>

<pre><code class="ruby">factory <span class="hljs-symbol">:user</span> <span class="hljs-keyword">do</span>
  first_name { <span class="hljs-string">&#x27;John&#x27;</span> }

  factory <span class="hljs-symbol">:sample_user</span> <span class="hljs-keyword">do</span>
    first_name { FFaker::Name.first_name }
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>

<pre><code class="ruby">create <span class="hljs-symbol">:sample_user</span>
</code></pre>
<p>See: <a href="http://www.rubydoc.info/gems/factory_bot/file/GETTING_STARTED.md#Inheritance">Inheritance</a></p>
<h3 id="sub-factories">Sub-factories</h3>

<pre><code class="ruby">factory <span class="hljs-symbol">:user</span> <span class="hljs-keyword">do</span>
  ···
<span class="hljs-keyword">end</span>
</code></pre>

<pre><code class="ruby">factory <span class="hljs-symbol">:sample_user</span>, <span class="hljs-symbol">parent:</span> <span class="hljs-symbol">:user</span> <span class="hljs-keyword">do</span>
  first_name { FFaker::Name.first_name }
<span class="hljs-keyword">end</span>
</code></pre>

<pre><code class="ruby">create <span class="hljs-symbol">:sample_user</span>
</code></pre>
<p>Works the same as nested factories.</p>
<h3 id="options-transients-">Options (transients)</h3>

<pre><code class="ruby">factory <span class="hljs-symbol">:user</span> <span class="hljs-keyword">do</span>
  transient <span class="hljs-keyword">do</span>
    upcased { <span class="hljs-literal">true</span> }
  <span class="hljs-keyword">end</span>

  after <span class="hljs-symbol">:create</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|user, options|</span>
    user.name.upcase! <span class="hljs-keyword">if</span> options.upcased
  <span class="hljs-keyword">end</span>
<span class="hljs-keyword">end</span>
</code></pre>

<pre><code class="ruby">create(user, <span class="hljs-symbol">upcased:</span> <span class="hljs-literal">true</span>)
</code></pre>
<p>Transient attributes will not get passed to the model, but will be available in after-create hooks.
See: <a href="http://www.rubydoc.info/gems/factory_bot/file/GETTING_STARTED.md#Transient_Attributes">Transient attributes</a></p>
<h3 id="paths">Paths</h3>

<ul>
<li>test/factories.rb</li>
<li>spec/factories.rb</li>
<li>test/factories/*.rb</li>
<li>spec/factories/*.rb</li>
</ul>
<p>Place your factories in these locations.</p>
<h2 id="see-also">See also</h2>

<ul>
<li><a href="http://rubydoc.info/gems/factory_bot/file/GETTING_STARTED.md">http://rubydoc.info/gems/factory_bot/file/GETTING_STARTED.md</a></li>
</ul>

</div>
</body>  
</html>