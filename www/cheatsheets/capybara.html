<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Capybara cheatsheet</title>
  <link href="s/main.css" rel="stylesheet" />
  <script src="s/main.js"></script>
</head>

<body onload="start()">
  <div class="breadcrumbs"><a href="/">Home</a> / <a href="index.html">cheatsheets</a> / Capybara cheatsheet</div>
  <div class="edit">
      <a href="https://github.com/kjk/blog/blob/master/www/cheatsheets/devhints\capybara.md" >edit</a>
  </div>
  <div class="toc">
<b>Main</b>: <a href="#navigating">Navigating</a>, <a href="#clicking-links-and-buttons">Clicking links and buttons</a>, <a href="#interacting-with-forms">Interacting with forms</a>, <a href="#limiting">Limiting</a><br>
<b>Querying</b>: <a href="#predicates">Predicates</a>, <a href="#selectors">Selectors</a>, <a href="#rspec-assertions">RSpec assertions</a>, <a href="#about-negatives">About negatives</a><br>
<b>RSpec</b>: <a href="#matchers">Matchers</a>, <a href="#common-options">Common options</a><br>
<b>Other features</b>: <a href="#finding">Finding</a>, <a href="#scoping">Scoping</a>, <a href="#scripting">Scripting</a>, <a href="#debugging">Debugging</a>, <a href="#page">Page</a>, <a href="#ajax">AJAX</a>, <a href="#misc">Misc</a>, <a href="#page-object">Page object</a>, <a href="#poltergeist">Poltergeist</a>, <a href="#blacklist">Blacklist</a>, <a href="#debugging1">Debugging</a><br>
<b>Selenium</b>: <a href="#accepting-confirm-and-alert-">Accepting confirm() and alert()</a>, <a href="#updating-session">Updating session</a><br>
<a href="#see-also">See also</a><br></div>


  <div id="start"></div>
  <div id="wrapped-content"></div>
<div id="content">
<h3 id="navigating">Navigating</h3>

<pre><code><span class="hljs-attribute">visit articles_path</span>
</code></pre>
<h3 id="clicking-links-and-buttons">Clicking links and buttons</h3>

<pre><code class="ruby">click_on <span class="hljs-string">&#x27;Link Text&#x27;</span>
click_button
click_link
</code></pre>
<h3 id="interacting-with-forms">Interacting with forms</h3>

<pre><code class="ruby">attach_file <span class="hljs-string">&#x27;Image&#x27;</span>, <span class="hljs-string">&#x27;/path/to/image.jpg&#x27;</span>
fill_in <span class="hljs-string">&#x27;First Name&#x27;</span>, <span class="hljs-symbol">with:</span> <span class="hljs-string">&#x27;John&#x27;</span>
</code></pre>

<pre><code class="ruby">check <span class="hljs-string">&#x27;A checkbox&#x27;</span>
uncheck <span class="hljs-string">&#x27;A checkbox&#x27;</span>
</code></pre>

<pre><code class="ruby">choose <span class="hljs-string">&#x27;A radio button&#x27;</span>
</code></pre>

<pre><code class="ruby">select <span class="hljs-string">&#x27;Option&#x27;</span>, <span class="hljs-symbol">from:</span> <span class="hljs-string">&#x27;Select box&#x27;</span>
unselect
</code></pre>
<h3 id="limiting">Limiting</h3>

<pre><code class="ruby">within <span class="hljs-string">&#x27;.classname&#x27;</span> <span class="hljs-keyword">do</span>
  click <span class="hljs-string">&#x27;...&#x27;</span>
<span class="hljs-keyword">end</span>
</code></pre>

<pre><code class="ruby">within_fieldset <span class="hljs-symbol">:id</span> <span class="hljs-keyword">do</span>
  ...
<span class="hljs-keyword">end</span>
</code></pre>
<h2 id="querying">Querying</h2>
<h3 id="predicates">Predicates</h3>

<pre><code class="ruby">page.has_css?(<span class="hljs-string">&#x27;.button&#x27;</span>)
expect(page).to have_css(<span class="hljs-string">&#x27;.button&#x27;</span>)
page.should have_css(<span class="hljs-string">&#x27;.button&#x27;</span>)
</code></pre>

<table>
<thead>
<tr>
<th>Positive</th>
<th>Negative</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>has_content?</code></td>
<td><code>has_no_content?</code></td>
</tr>
<tr>
<td>---</td>
<td>---</td>
</tr>
<tr>
<td><code>has_css?</code> <em>(selector)</em></td>
<td><code>has_no_css?</code></td>
</tr>
<tr>
<td>---</td>
<td>---</td>
</tr>
<tr>
<td><code>has_xpath?</code> <em>(path)</em></td>
<td><code>has_no_xpath?</code></td>
</tr>
<tr>
<td>---</td>
<td>---</td>
</tr>
<tr>
<td><code>has_link?</code> <em>(selector)</em></td>
<td><code>has_no_link?</code></td>
</tr>
<tr>
<td>---</td>
<td>---</td>
</tr>
<tr>
<td><code>has_button?</code> <em>(selector)</em></td>
<td><code>has_no_button?</code></td>
</tr>
<tr>
<td>---</td>
<td>---</td>
</tr>
<tr>
<td><code>has_field?</code> <em>(selector)</em></td>
<td><code>has_no_field?</code></td>
</tr>
<tr>
<td>---</td>
<td>---</td>
</tr>
<tr>
<td><code>has_checked_field?</code> <em>(selector)</em></td>
<td><code>has_unchecked_field?</code></td>
</tr>
<tr>
<td>---</td>
<td>---</td>
</tr>
<tr>
<td><code>has_table?</code> <em>(selector)</em></td>
<td><code>has_no_table?</code></td>
</tr>
<tr>
<td>---</td>
<td>---</td>
</tr>
<tr>
<td><code>has_select?</code> <em>(selector)</em></td>
<td><code>has_no_select?</code></td>
</tr>
</tbody>
</table>
<p>In Rspec, these also map to matchers like <code>page.should have_content</code>.</p>
<h3 id="selectors">Selectors</h3>

<pre><code class="ruby">expect(page).to have_button(<span class="hljs-string">&#x27;Save&#x27;</span>)
</code></pre>

<pre><code class="ruby">expect(page).to have_button(<span class="hljs-string">&#x27;#submit&#x27;</span>)
</code></pre>

<pre><code class="ruby">expect(page).to have_button(<span class="hljs-string">&#x27;//[@id=&quot;submit&quot;]&#x27;</span>)
</code></pre>
<p>The <code>selector</code> arguments can be text, CSS selector, or XPath expression.</p>
<h3 id="rspec-assertions">RSpec assertions</h3>

<pre><code class="ruby">page.has_button?(<span class="hljs-string">&#x27;Save&#x27;</span>)
</code></pre>

<pre><code class="ruby">expect(page).to have_no_button(<span class="hljs-string">&#x27;Save&#x27;</span>)
</code></pre>
<p>In RSpec, you can use <code>page.should</code> assertions.</p>
<h3 id="about-negatives">About negatives</h3>

<pre><code class="ruby">expect(page).to have_no_button(<span class="hljs-string">&#x27;Save&#x27;</span>)   <span class="hljs-comment"># OK</span>
</code></pre>

<pre><code class="ruby">expect(page).not_to have_button(<span class="hljs-string">&#x27;Save&#x27;</span>)  <span class="hljs-comment"># Bad</span>
</code></pre>
<p>Use <code>should have_no_*</code> versions with RSpec matchers because
<code>should_not have_*</code> doesn&#39;t wait for a timeout from the driver.</p>
<h2 id="rspec">RSpec</h2>
<h3 id="matchers">Matchers</h3>

<pre><code class="ruby">expect(page).to \
</code></pre>

<pre><code class="ruby">  have_selector <span class="hljs-string">&#x27;.blank-state&#x27;</span>
  have_selector <span class="hljs-string">&#x27;h1#hola&#x27;</span>, <span class="hljs-symbol">text:</span> <span class="hljs-string">&#x27;Welcome&#x27;</span>
  have_button <span class="hljs-string">&#x27;Save&#x27;</span>
  have_checked_field <span class="hljs-string">&#x27;#field&#x27;</span>
  have_unchecked_field
  have_css <span class="hljs-string">&#x27;.class&#x27;</span>
  have_field <span class="hljs-string">&#x27;#field&#x27;</span>
  have_table <span class="hljs-string">&#x27;#table&#x27;</span>
  have_xpath <span class="hljs-string">&#x27;//div&#x27;</span>
</code></pre>

<pre><code class="ruby">  have_link <span class="hljs-string">&#x27;Logout&#x27;</span>, <span class="hljs-symbol">href:</span> logout_path
</code></pre>

<pre><code class="ruby">  have_select <span class="hljs-string">&#x27;Language&#x27;</span>,
    <span class="hljs-symbol">selected:</span> <span class="hljs-string">&#x27;German&#x27;</span>
    <span class="hljs-symbol">options:</span> [<span class="hljs-string">&#x27;Engish&#x27;</span>, <span class="hljs-string">&#x27;German&#x27;</span>]
    <span class="hljs-symbol">with_options:</span> [<span class="hljs-string">&#x27;Engish&#x27;</span>, <span class="hljs-string">&#x27;German&#x27;</span>] <span class="hljs-comment"># partial match</span>
</code></pre>

<pre><code class="ruby">  have_text <span class="hljs-string">&#x27;Hello&#x27;</span>,
    <span class="hljs-symbol">type:</span> <span class="hljs-symbol">:visible</span> <span class="hljs-comment"># or :all</span>
    <span class="hljs-comment"># alias: have_content</span>
</code></pre>
<h3 id="common-options">Common options</h3>
<p>All matchers have these options:</p>

<pre><code class="ruby">  <span class="hljs-symbol">text:</span> <span class="hljs-string">&#x27;welcome&#x27;</span>
  <span class="hljs-symbol">text:</span> /Hello/
  <span class="hljs-symbol">visible:</span> <span class="hljs-literal">true</span>
  <span class="hljs-symbol">count:</span> <span class="hljs-number">4</span>
  <span class="hljs-symbol">between:</span> <span class="hljs-number">2</span>..<span class="hljs-number">5</span>
  <span class="hljs-symbol">minimum:</span> <span class="hljs-number">2</span>
  <span class="hljs-symbol">maximum:</span> <span class="hljs-number">5</span>
  <span class="hljs-symbol">wait:</span> <span class="hljs-number">10</span>
</code></pre>
<h2 id="other-features">Other features</h2>
<h3 id="finding">Finding</h3>

<pre><code class="ruby">find(selector)
find_button(selector)
find_by_id(id)
find_field(selector)
find_link(selector)
locate
</code></pre>
<h3 id="scoping">Scoping</h3>

<pre><code class="ruby">within <span class="hljs-string">&#x27;#delivery&#x27;</span> <span class="hljs-keyword">do</span>
  fill_in <span class="hljs-string">&#x27;Street&#x27;</span>, <span class="hljs-symbol">with:</span> <span class="hljs-string">&#x27;Hello&#x27;</span>
<span class="hljs-keyword">end</span>
</code></pre>

<pre><code class="ruby">within <span class="hljs-symbol">:xpath</span>, <span class="hljs-string">&#x27;//article&#x27;</span>
within_fieldset
within_table
within_frame
scope_to
</code></pre>

<pre><code class="ruby">find(<span class="hljs-string">&#x27;#x&#x27;</span>).fill_in(<span class="hljs-string">&#x27;Street&#x27;</span>, <span class="hljs-symbol">with:</span> <span class="hljs-string">&#x27;Hello&#x27;</span>)
<span class="hljs-comment"># same as within</span>
</code></pre>
<h3 id="scripting">Scripting</h3>

<pre><code class="ruby">execute_script(<span class="hljs-string">&#x27;$(&quot;input&quot;).trigger(&quot;change&quot;)&#x27;</span>)
evaluate_script(<span class="hljs-string">&#x27;window.ga&#x27;</span>)
</code></pre>
<p>Executes JavaScript.</p>
<h3 id="debugging">Debugging</h3>

<pre><code class="ruby">save_and_open_page
</code></pre>
<p>Opens the webpage in your browser.</p>
<h3 id="page">Page</h3>

<pre><code class="ruby">page
  .all(<span class="hljs-string">&#x27;h3&#x27;</span>)
  .body
  .html
  .source
  .current_host
  .current_path
  .current_url
</code></pre>
<h3 id="ajax">AJAX</h3>

<pre><code class="ruby">using_wait_time <span class="hljs-number">10</span> <span class="hljs-keyword">do</span>
  ...
<span class="hljs-keyword">end</span>
</code></pre>
<h3 id="misc">Misc</h3>

<pre><code><span class="hljs-attribute">drag
field_labeled</span>
</code></pre>
<h3 id="page-object">Page object</h3>

<pre><code class="ruby">page.status_code == <span class="hljs-number">200</span>
page.response_headers
</code></pre>
<p>See: <a href="http://www.rubydoc.info/github/jnicklas/capybara/master/Capybara/Session">http://www.rubydoc.info/github/jnicklas/capybara/master/Capybara/Session</a></p>
<h3 id="poltergeist">Poltergeist</h3>

<pre><code class="ruby">Capybara.register_driver <span class="hljs-symbol">:poltergeist</span> <span class="hljs-keyword">do</span> <span class="hljs-params">|app|</span>
  Capybara::Poltergeist::Driver.new(app, <span class="hljs-symbol">:inspector</span> =&gt; <span class="hljs-literal">true</span>)
<span class="hljs-keyword">end</span>
Capybara.javascript_driver = <span class="hljs-symbol">:poltergeist</span>
</code></pre>
<p>Use <a href="https://github.com/teampoltergeist/poltergeist">poltergeist</a> to integrate PhantomJS.</p>
<h3 id="blacklist">Blacklist</h3>

<pre><code class="ruby">config.before <span class="hljs-symbol">:each</span>, <span class="hljs-symbol">:js</span> <span class="hljs-keyword">do</span>
  page.driver.browser.url_blacklist = [
    <span class="hljs-string">&#x27;fonts.googleapis.com&#x27;</span>,
    <span class="hljs-string">&#x27;use.typekit.net&#x27;</span>,
    <span class="hljs-string">&#x27;f.vimeocdn.com&#x27;</span>,
    <span class="hljs-string">&#x27;player.vimeo.com&#x27;</span>,
    <span class="hljs-string">&#x27;www.googletagmanager.com&#x27;</span>
  ].flat_map { <span class="hljs-params">|domain|</span> [ <span class="hljs-string">&quot;http://<span class="hljs-subst">#{domain}</span>&quot;</span>, <span class="hljs-string">&quot;https://<span class="hljs-subst">#{domain}</span>&quot;</span> ] }
<span class="hljs-keyword">end</span>
</code></pre>
<h3 id="debugging1">Debugging</h3>
<p>Enable <code>inspector: true</code> and then:</p>

<pre><code class="ruby">page.driver.debug
</code></pre>
<p>To pause execution for a while:</p>

<pre><code class="ruby">page.driver.pause
</code></pre>
<h2 id="selenium">Selenium</h2>
<h3 id="accepting-confirm-and-alert-">Accepting confirm() and alert()</h3>

<pre><code class="ruby">accept_alert { ... }
dismiss_confirm { ... }
accept_prompt(<span class="hljs-symbol">with:</span> <span class="hljs-string">&#x27;hi&#x27;</span>) { ... }
</code></pre>
<p>Alternatively:</p>

<pre><code class="ruby">page.driver.browser.switch_to.alert.accept
</code></pre>
<h3 id="updating-session">Updating session</h3>

<pre><code class="ruby">page.set_rack_session(<span class="hljs-symbol">foo:</span> <span class="hljs-string">&#x27;bar&#x27;</span>)
</code></pre>
<h2 id="see-also">See also</h2>

<ul>
<li><a href="http://rubydoc.info/github/jnicklas/capybara/Capybara/RSpecMatchers">http://rubydoc.info/github/jnicklas/capybara/Capybara/RSpecMatchers</a></li>
<li><a href="http://www.rubydoc.info/github/jnicklas/capybara/master/Capybara/Node/Matchers">http://www.rubydoc.info/github/jnicklas/capybara/master/Capybara/Node/Matchers</a></li>
</ul>

</div>
</body>  
</html>